<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Katalog Undangan Digital</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. FIREBASE COMPAT -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wa: {
                            bg: '#111b21',       /* Background Utama Gelap */
                            header: '#202c33',   /* Header/Card Background */
                            button: '#2a373f',   /* Button Lighter */
                            teal: '#00a884',     /* Hijau WA */
                            light: '#e9edef',    /* Teks Utama */
                            gray: '#8696a0',     /* Teks Secondary */
                            divider: '#222d36'   /* Garis Pembatas */
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #111b21; color: #e9edef; -webkit-tap-highlight-color: transparent; }
        
        /* Custom Scrollbar for smoother app-feel */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth Scrolling Behaviour */
        .smooth-scroll {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; /* Momentum scrolling on iOS */
            overscroll-behavior-y: contain; /* Prevent parent scrolling */
        }

        .snap-x { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }
        
        /* Transisi Halaman */
        .view-section { display: none; animation: fadeIn 0.2s ease-out; }
        .view-active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Animasi Gallery & Bottom Sheet */
        #view-gallery, #feature-sheet { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; }
        .sheet-open { transform: translateY(0); }
        .sheet-closed { transform: translateY(100%); }
        .backdrop-open { opacity: 1; pointer-events: auto; }
        .backdrop-closed { opacity: 0; pointer-events: none; }
        
        /* Gallery Animation */
        .gallery-open { opacity: 1; pointer-events: auto; transform: scale(1); }
        .gallery-closed { opacity: 0; pointer-events: none; transform: scale(0.95); }
    </style>
</head>

<body class="antialiased min-h-screen pb-20 bg-[#0b141a]">

    <!-- =======================
         VIEW 1: HOME (TIER LIST)
    ======================== -->
    <div id="view-home" class="view-section view-active bg-wa-bg min-h-screen">
        <!-- Header Home -->
        <div class="sticky top-0 z-40 bg-wa-header/95 backdrop-blur-sm shadow-md border-b border-wa-divider">
            <div class="px-4 h-14 flex justify-between items-center max-w-md mx-auto">
                <h1 class="font-bold text-lg text-wa-light tracking-wide flex items-center gap-2">
                    <span class="text-wa-teal">‚óè</span> Katalog
                </h1>
                <div class="flex gap-4">
                    <svg class="w-5 h-5 text-wa-gray hover:text-wa-light transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>
            
            <!-- Filter Chips -->
            <div class="px-4 pb-3 flex gap-2 overflow-x-auto hide-scroll max-w-md mx-auto pt-1">
                <button class="bg-wa-teal text-wa-bg px-4 py-1.5 rounded-full text-xs font-bold shadow-lg shadow-wa-teal/20 transition hover:bg-[#008f6f]">Semua</button>
                <button class="bg-[#374248] text-wa-gray px-4 py-1.5 rounded-full text-xs font-medium border border-wa-divider hover:bg-[#435057] transition">Wedding</button>
                <button class="bg-[#374248] text-wa-gray px-4 py-1.5 rounded-full text-xs font-medium border border-wa-divider hover:bg-[#435057] transition">Khitan</button>
            </div>
        </div>

        <!-- HERO SECTION -->
        <div class="relative w-full h-[450px] overflow-hidden border-b border-wa-divider/50 group bg-wa-bg">
            <div class="absolute inset-0 max-w-md mx-auto relative h-full">
                <img src="https://ik.imagekit.io/undangandigital/general/hero.webp" class="w-full h-full object-cover opacity-50 transition-transform duration-1000 group-hover:scale-105" alt="Hero Banner">
                <div class="absolute inset-0 bg-gradient-to-t from-wa-bg via-wa-bg/80 to-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-wa-bg/40 to-transparent"></div>
                
                <div class="absolute inset-0 flex flex-col justify-end items-center text-center px-6 pb-12 z-10">
                    <div class="mb-4 animate-[fadeIn_0.8s_ease-out]">
                        <span class="inline-block py-1 px-3 rounded-full bg-wa-teal/10 border border-wa-teal/30 text-wa-teal text-[10px] font-bold tracking-widest uppercase mb-3 backdrop-blur-sm">Premium Collection</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-white leading-tight mb-2 tracking-tight">Undangan Digital <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-teal-300 to-emerald-500">Eksklusif & Modern</span></h2>
                        <p class="text-wa-gray text-xs md:text-sm max-w-md mx-auto leading-relaxed">Temukan berbagai undangan premium dengan desain eksklusif. Jadikan hari spesialmu lebih berkesan & modern.</p>
                    </div>
                    <button onclick="kirimPesanWA()" class="bg-wa-teal text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-wa-teal/30 text-sm flex items-center gap-2 hover:bg-[#008f6f] active:scale-95 transition-all animate-[fadeIn_1s_ease-out_0.3s_both]">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                        Konsultasi Gratis
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Skeleton -->
        <div id="home-loading" class="max-w-md mx-auto p-4 space-y-8">
            <div class="space-y-3">
                <div class="h-6 w-32 bg-wa-header rounded animate-pulse"></div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="aspect-[4/5] bg-wa-header rounded-xl animate-pulse"></div>
                    <div class="aspect-[4/5] bg-wa-header rounded-xl animate-pulse"></div>
                </div>
            </div>
        </div>
        
        <!-- Error Message (Hidden by default) -->
        <div id="error-message" class="hidden max-w-md mx-auto p-6 text-center">
            <div class="bg-red-900/30 border border-red-500/50 text-red-200 p-4 rounded-xl">
                <p class="font-bold text-sm">Gagal Memuat Data</p>
                <p id="error-text" class="text-xs mt-1 opacity-80">Periksa koneksi internet Anda.</p>
                <button onclick="location.reload()" class="mt-3 bg-red-600 px-4 py-2 rounded-lg text-xs font-bold">Coba Lagi</button>
            </div>
        </div>

        <!-- Container List Tier -->
        <div id="tier-list-container" class="max-w-md mx-auto pb-10 space-y-6 mt-4"></div>
    </div>


    <!-- =======================
         VIEW 2: CATEGORY FULL
    ======================== -->
    <div id="view-category" class="view-section bg-wa-bg min-h-screen">
        <div class="sticky top-0 z-40 bg-wa-header shadow-md border-b border-wa-divider">
            <div class="px-2 h-14 flex items-center gap-2 max-w-md mx-auto">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-[#374248] transition">
                    <svg class="w-6 h-6 text-wa-light" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <h1 id="cat-header-title" class="font-medium text-lg text-wa-light">Nama Kategori</h1>
            </div>
        </div>
        <div id="cat-grid-container" class="max-w-md mx-auto p-3 grid grid-cols-2 gap-3"></div>
    </div>


    <!-- =======================
         VIEW 3: DETAIL PRODUCT
    ======================== -->
    <div id="view-detail" class="view-section bg-wa-bg min-h-screen">
        <!-- Header Detail -->
        <div class="fixed top-0 w-full z-50 max-w-md mx-auto left-0 right-0 pointer-events-none">
            <div class="flex justify-between items-center p-4 bg-gradient-to-b from-black/70 to-transparent">
                <button onclick="goBack()" class="bg-black/30 backdrop-blur-md p-2 rounded-full text-white hover:bg-black/50 transition pointer-events-auto border border-white/10">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
            </div>
        </div>

        <!-- Image Slider (Horizontal Thumbnail) -->
        <div class="max-w-md mx-auto relative bg-black group">
            <div class="w-full aspect-square relative overflow-hidden">
                <div id="detail-slider" class="flex overflow-x-auto snap-x snap-mandatory hide-scroll h-full items-center px-4 gap-3 smooth-scroll"></div>
                
                <!-- Hint Overlay -->
                <div class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="bg-black/50 backdrop-blur px-3 py-1 rounded-full border border-white/20">
                        <span class="text-white text-xs font-medium">Klik untuk memperbesar</span>
                    </div>
                </div>

                <!-- ADDED: Navigation Arrows -->
                <button onclick="scrollSlider(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/40 backdrop-blur-md p-2 rounded-full text-white border border-white/10 hover:bg-black/60 transition z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <button onclick="scrollSlider(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/40 backdrop-blur-md p-2 rounded-full text-white border border-white/10 hover:bg-black/60 transition z-10 animate-pulse">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-white/10">
                <div id="slider-progress" class="h-full bg-wa-teal transition-all duration-300 w-[10%] shadow-[0_0_10px_rgba(0,168,132,0.5)]"></div>
            </div>
        </div>

        <!-- Content Body -->
        <div class="max-w-md mx-auto bg-wa-bg p-5 pb-24">
            <!-- Title & Price -->
            <div class="border-b border-wa-divider pb-5 mb-5">
                <div class="flex justify-between items-start">
                    <h1 id="detail-title" class="text-xl font-bold text-wa-light leading-snug tracking-tight"></h1>
                    <span id="detail-category" class="text-[10px] font-bold text-wa-teal bg-wa-teal/10 border border-wa-teal/20 px-2.5 py-1 rounded-full uppercase tracking-wider ml-2 shrink-0">Wedding</span>
                </div>
                <div class="mt-3 flex items-center gap-3">
                    <span id="detail-price-real" class="text-2xl font-bold text-wa-light"></span>
                    <span id="detail-price-fake" class="text-sm text-wa-gray line-through decoration-red-500/50 decoration-2"></span>
                </div>
                <div id="detail-preview-buttons" class="mt-6"></div>
            </div>

            <!-- Description -->
            <div class="space-y-3">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest flex items-center gap-2">
                    <span class="w-1 h-4 bg-wa-teal rounded-full"></span>
                    Deskripsi Item
                </h3>
                <p id="detail-desc" class="text-sm text-wa-light leading-relaxed whitespace-pre-line"></p>
            </div>

            <!-- PHOTO REQUIRED ALERT -->
            <div id="detail-photo-alert" class="mt-6 hidden"></div>

            <!-- Variants Chips -->
            <div class="mt-8 pt-5 border-t border-wa-divider">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest mb-3 flex items-center gap-2">
                    <span class="w-1 h-4 bg-wa-teal rounded-full"></span>
                    VARIAN TEMA
                </h3>
                <div id="detail-variants" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- FEATURES CHIPS SECTION -->
            <div class="mt-8 pt-5 border-t border-wa-divider">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="w-1 h-4 bg-wa-teal rounded-full"></span>
                    FITUR LENGKAP
                </h3>
                <div id="detail-features" class="flex flex-wrap gap-2">
                    <!-- Features injected here -->
                </div>
            </div>
        </div>

        <!-- Sticky Footer -->
        <div class="fixed bottom-0 w-full bg-wa-header/95 backdrop-blur-md border-t border-wa-divider p-3 z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.2)]">
            <div class="max-w-md mx-auto flex gap-3">
                <button onclick="kirimPesanWA()" class="flex-1 bg-wa-teal text-white font-bold py-3.5 rounded-full shadow-lg shadow-wa-teal/20 text-sm flex justify-center items-center gap-2 hover:bg-[#008f6f] active:scale-[0.98] transition group">
                    <svg class="w-5 h-5 group-hover:animate-bounce" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                    Pesan via WhatsApp
                </button>
            </div>
        </div>

        <!-- =======================
             COMPONENTS: MODALS / SHEETS
        ======================== -->
        
        <!-- Fullscreen Gallery (Vertical Scroll, Desktop Constrained) -->
        <div id="view-gallery" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-sm gallery-closed flex justify-center">
            <!-- Constrained Container for Desktop -->
            <div class="relative w-full max-w-md h-full bg-black shadow-2xl flex flex-col border-x border-wa-divider/30">
                <!-- Close Button Floats -->
                <div class="absolute top-0 right-0 p-4 z-50">
                    <button onclick="closeGallery()" class="bg-black/50 text-white p-3 rounded-full backdrop-blur-md border border-white/20 hover:bg-white/20 transition shadow-lg active:scale-90">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                
                <!-- Gallery Content: Vertical Scroll -->
                <div id="gallery-container" class="flex-1 w-full h-full overflow-y-auto bg-black hide-scroll smooth-scroll">
                    <!-- Images will be injected here as w-full blocks -->
                </div>
                
                <!-- Indicator Floating Bottom -->
                <div class="absolute bottom-8 left-0 right-0 text-center pointer-events-none opacity-80">
                    <span class="bg-black/60 text-white text-[10px] px-4 py-2 rounded-full backdrop-blur border border-white/10 font-medium tracking-widest uppercase shadow-lg">Scroll Down</span>
                </div>
            </div>
        </div>

        <!-- Feature Detail Bottom Sheet -->
        <div id="feature-backdrop" onclick="closeFeatureSheet()" class="fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm backdrop-closed transition-opacity duration-300"></div>
        <div id="feature-sheet" class="fixed bottom-0 left-0 right-0 z-[61] bg-[#202c33] rounded-t-[2rem] p-6 sheet-closed border-t border-wa-divider shadow-2xl max-w-md mx-auto">
            <div class="w-12 h-1.5 bg-wa-divider rounded-full mx-auto mb-6"></div>
            <div class="flex items-start gap-4">
                <div id="sheet-icon" class="bg-wa-teal/10 p-3 rounded-xl text-wa-teal shrink-0"></div>
                <div>
                    <h3 id="sheet-title" class="text-lg font-bold text-white mb-2"></h3>
                    <p id="sheet-desc" class="text-sm text-wa-gray leading-relaxed"></p>
                </div>
            </div>
            <button onclick="closeFeatureSheet()" class="mt-8 w-full bg-wa-button py-3 rounded-xl text-sm font-medium text-wa-teal hover:bg-wa-divider transition">Tutup</button>
        </div>


    <!-- SCRIPT LOGIC -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDq6LjlUFRDm5CqGSqVLiJ9gItIyw71bAU",
            authDomain: "db-katalog.firebaseapp.com",
            projectId: "db-katalog",
            storageBucket: "db-katalog.firebasestorage.app",
            messagingSenderId: "597535674259",
            appId: "1:597535674259:web:0577885c617f623bb82266"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let allProducts = [];
        let groupedProducts = {};
        const IMAGEKIT_BASE = "https://ik.imagekit.io/undangandigital";
        
        // Ensure New Tiers appear
        const TIER_ORDER = ["Starter", "Bronze", "Silver", "Gold", "Platinum", "Diamond", "Tema Adat Batak", "Tema Adat Karo"];
        
        const TIER_CONFIG = { 
            "Starter": "üü¢", 
            "Bronze": "üü§", 
            "Silver": "‚ö™", 
            "Gold": "üü°", 
            "Platinum": "üîµ", 
            "Diamond": "üíé",
            "Tema Adat Batak": "üî¥",
            "Tema Adat Karo": "üî¥"
        };

        // DATA FITUR LENGKAP
        const FEATURES_DB = [
            { id: 'guest', title: "Custom Nama Tamu", icon: "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z", desc: "Sebarkan undanganmu lebih personal dengan menulis nama mereka secara otomatis pada cover undangan." },
            { id: 'unlimited', title: "Unlimited Tamu", icon: "M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z", desc: "Kamu bisa kirim undanganmu kepada sebanyak mungkin tamu yang mau kamu undang tanpa biaya tambahan." },
            { id: 'music', title: "Autoplay Musik", icon: "M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3", desc: "Lagu favoritmu akan otomatis berputar mengiringi undangan saat dibuka oleh tamu." },
            { id: 'gallery', title: "Galeri Foto/Video", icon: "M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z", desc: "Bagikan momen bahagiamu dengan menampilkan galeri foto prewedding dan video cinematic." },
            { id: 'animasi', title: "Animasi Gratis", icon: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z", desc: "Kami sediakan ratusan karakter animasi lucu dan menarik yang bisa kamu pakai gratis." },
            { id: 'rsvp', title: "Fitur RSVP", icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4", desc: "Dapatkan kepastian jumlah tamu dengan fitur konfirmasi kehadiran (Hadir/Tidak/Ragu)." },
            { id: 'wishes', title: "Ucapan & Doa", icon: "M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z", desc: "Tamu undangan bisa memberikan ucapan selamat dan doa restu langsung di dalam undangan." },
            { id: 'gift', title: "Wedding Gift", icon: "M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7", desc: "Memudahkan tamu mengirimkan hadiah atau angpao digital melalui transfer bank/e-wallet." },
            { id: 'love', title: "Love Story", icon: "M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z", desc: "Ceritakan perjalanan kisah cintamu dengan pasangan dari awal bertemu hingga pelaminan." },
            { id: 'countdown', title: "Countdown", icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z", desc: "Hitung mundur waktu menuju momen bahagiamu agar tamu selalu ingat tanggalnya." },
            { id: 'gcal', title: "Google Calendar", icon: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z", desc: "Tamu bisa menyimpan jadwal acaramu ke Google Calendar mereka dengan satu klik." },
            { id: 'quotes', title: "Ayat & Quotes", icon: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253", desc: "Tampilkan ayat suci atau kata-kata mutiara favoritmu sebagai pemanis undangan." },
            { id: 'maps', title: "Peta Navigasi", icon: "M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0zM15 11a3 3 0 11-6 0 3 3 0 016 0z", desc: "Panduan lokasi acara akurat dengan Google Maps agar tamu mudah menemukan tempatnya." },
            { id: 'tools', title: "Sender Tools", icon: "M12 19l9 2-9-18-9 18 9-2zm0 0v-8", desc: "Fitur eksklusif untuk mengirim undangan ke banyak kontak WhatsApp secara otomatis & personal." }
        ];

        window.addEventListener('hashchange', router);

        function router() {
            const hash = window.location.hash;
            closeGallery(); 
            closeFeatureSheet(); 

            if (!hash || hash === '#/') {
                switchView('view-home');
                return;
            }
            if (hash.startsWith('#/category/')) {
                const tier = decodeURIComponent(hash.split('/')[2]);
                renderCategoryView(tier);
                switchView('view-category');
                return;
            }
            if (hash.startsWith('#/detail/')) {
                const id = hash.split('/')[2];
                if (allProducts.length > 0) {
                    const item = allProducts.find(p => p.id === id);
                    if (item) {
                        renderDetailView(item);
                        switchView('view-detail');
                    } else {
                        window.location.hash = '#/';
                    }
                }
                return;
            }
        }

        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('view-active'));
            document.getElementById(viewId).classList.add('view-active');
            window.scrollTo(0,0);
        }

        function navigateTo(path) {
            window.location.hash = path;
        }

        function goBack() {
            window.history.back();
        }

        async function loadData() {
            try {
                const snapshot = await db.collection('themes').get();
                
                const loadingEl = document.getElementById('home-loading');
                if (loadingEl) loadingEl.style.display = 'none';

                if (snapshot.empty) { 
                    alert("Data kosong!"); 
                    return; 
                }

                allProducts = snapshot.docs.map(doc => {
                    let d = doc.data();
                    let variants = d.variants || [];
                    if (Array.isArray(variants)) {
                        variants = variants.map(v => v.trim()); 
                    }
                    
                    let desc = d.description || '';
                    desc = desc.replace(/\n\uFFFD/g, '\n‚Ä¢').replace(/^\uFFFD/, '‚Ä¢');
                    desc = desc.replace(/\uFFFD/g, '-');

                    return {
                        id: doc.id,
                        title: d.title || d['title '] || 'Tanpa Judul',
                        category: d.category || 'Umum',
                        price_real: d.price_real || d['price-real'] || 0,
                        price_fake: d.price_fake || d['price-fake'] || 0,
                        description: desc,
                        folder_id: d.folder_id || doc.id,
                        tier: (d.tier || 'Starter').trim(),
                        variants: variants,
                        link: d.link || '#',
                        photoRequired: d['photo-required'] || d.photo_required || 'no'
                    };
                });

                groupedProducts = {};
                allProducts.forEach(p => {
                    const tier = p.tier;
                    if(!groupedProducts[tier]) groupedProducts[tier] = [];
                    groupedProducts[tier].push(p);
                });

                renderHome();
                router();

            } catch (error) {
                console.error("Error:", error);
                const loadingEl = document.getElementById('home-loading');
                if (loadingEl) loadingEl.style.display = 'none';
                
                const errorEl = document.getElementById('error-message');
                if (errorEl) {
                    errorEl.classList.remove('hidden');
                    document.getElementById('error-text').innerText = error.message;
                }
            }
        }

        function renderHome() {
            const container = document.getElementById('tier-list-container');
            container.innerHTML = '';

            const dbTiers = Object.keys(groupedProducts);
            const extraTiers = dbTiers.filter(t => !TIER_ORDER.includes(t));
            const finalTierList = [...TIER_ORDER, ...extraTiers];

            finalTierList.forEach(tier => {
                const products = groupedProducts[tier];
                if (!products || products.length === 0) return;

                const prices = products.map(p => p.price_real);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const priceRange = minPrice === maxPrice 
                    ? `All price at Rp${Math.floor(minPrice/1000)}k` 
                    : `Rp${Math.floor(minPrice/1000)}k - Rp${Math.floor(maxPrice/1000)}k`;

                const emoji = TIER_CONFIG[tier] || "üî¥"; 
                const previewProducts = products.slice(0, 3);
                
                let cardsHtml = '';
                previewProducts.forEach(item => {
                    const imgUrl = `${IMAGEKIT_BASE}/${item.folder_id}/01.png?tr=w-400`;
                    const price = 'Rp' + Math.floor(item.price_real / 1000) + 'k';
                    const fakePrice = 'Rp' + Math.floor(item.price_fake / 1000) + 'k';
                    
                    let discountHtml = '';
                    if (item.price_fake > item.price_real) {
                        const discount = Math.round(((item.price_fake - item.price_real) / item.price_fake) * 100);
                        discountHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10 border border-white/10">-${discount}%</div>`;
                    }

                    cardsHtml += `
                        <div onclick="navigateTo('#/detail/${item.id}')" class="group relative bg-[#202c33] rounded-xl overflow-hidden border border-wa-divider hover:border-wa-teal/50 transition-all duration-300 active:scale-[0.98] cursor-pointer shadow-sm">
                            <div class="aspect-square overflow-hidden relative">
                                ${discountHtml}
                                <img src="${imgUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                            </div>
                            <div class="p-3">
                                <h4 class="text-sm text-wa-light font-medium truncate group-hover:text-white transition-colors tracking-tight">${item.title}</h4>
                                <div class="flex items-center gap-1.5 mt-1.5">
                                    <span class="text-sm text-wa-teal font-bold">${price}</span>
                                    ${item.price_fake > item.price_real ? `<span class="text-[10px] text-wa-gray line-through decoration-red-500/50">${fakePrice}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                const section = document.createElement('div');
                section.className = "mb-4"; 
                section.innerHTML = `
                    <div class="px-4 flex justify-between items-center mb-3">
                        <div class="border-l-4 border-wa-teal pl-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg filter drop-shadow-sm">${emoji}</span>
                                <h2 class="text-wa-light font-bold text-base tracking-wide">${tier}</h2>
                            </div>
                            <p class="text-[11px] text-wa-gray mt-0.5 font-medium tracking-wide uppercase">${priceRange}</p>
                        </div>
                        <button onclick="navigateTo('#/category/${tier}')" class="bg-[#2a373f] border border-wa-divider text-wa-teal text-[11px] font-bold px-3.5 py-1.5 rounded-full hover:bg-wa-teal hover:text-white hover:border-transparent transition active:scale-95 shadow-sm uppercase tracking-wider">
                            Lihat Semua
                        </button>
                    </div>
                    <div class="px-4 grid grid-cols-3 gap-3">
                        ${cardsHtml}
                    </div>
                `;
                container.appendChild(section);
            });
        }

        function renderCategoryView(tierName) {
            const products = groupedProducts[tierName];
            if(!products) return;
            const emoji = TIER_CONFIG[tierName] || "üî¥";

            document.getElementById('cat-header-title').innerText = `${emoji} ${tierName}`;
            const container = document.getElementById('cat-grid-container');
            container.innerHTML = '';

            products.forEach(item => {
                const imgUrl = `${IMAGEKIT_BASE}/${item.folder_id}/01.png?tr=w-400`;
                const price = 'Rp' + Math.floor(item.price_real / 1000) + 'k';
                const fakePrice = 'Rp' + Math.floor(item.price_fake / 1000) + 'k';
                
                let discountHtml = '';
                if (item.price_fake > item.price_real) {
                    const discount = Math.round(((item.price_fake - item.price_real) / item.price_fake) * 100);
                    discountHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10 border border-white/10">-${discount}%</div>`;
                }

                const card = document.createElement('div');
                card.className = "group relative bg-[#202c33] rounded-xl overflow-hidden border border-wa-divider hover:border-wa-teal/50 transition-all duration-300 active:scale-[0.98] cursor-pointer shadow-sm";
                card.onclick = () => navigateTo(`#/detail/${item.id}`);
                card.innerHTML = `
                    <div class="aspect-square overflow-hidden relative">
                        ${discountHtml}
                        <img src="${imgUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                    </div>
                    <div class="p-3">
                        <h4 class="text-sm text-wa-light font-medium truncate group-hover:text-white transition-colors tracking-tight">${item.title}</h4>
                        <div class="flex items-center gap-1.5 mt-1.5">
                            <span class="text-sm text-wa-teal font-bold">${price}</span>
                            ${item.price_fake > item.price_real ? `<span class="text-[10px] text-wa-gray line-through decoration-red-500/50">${fakePrice}</span>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderDetailView(item) {
            window.currentItem = item;
            window.currentGalleryItem = item; // Penting untuk gallery

            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-price-real').innerText = 'Rp ' + item.price_real.toLocaleString('id-ID');
            document.getElementById('detail-price-fake').innerText = 'Rp ' + item.price_fake.toLocaleString('id-ID');
            document.getElementById('detail-desc').innerText = item.description;

            // --- PHOTO REQUIRED ALERT ---
            const alertContainer = document.getElementById('detail-photo-alert');
            if (item.photoRequired === 'yes') {
                alertContainer.innerHTML = `
                    <div class="bg-yellow-900/20 border border-yellow-600/30 rounded-xl p-4 flex items-start gap-3">
                        <svg class="w-5 h-5 text-yellow-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        <div>
                            <h4 class="text-sm font-bold text-yellow-500 mb-1">Penting!</h4>
                            <p class="text-xs text-wa-light/80 leading-relaxed">Tema ini memerlukan banyak foto prewedding (minimal 5 foto) untuk hasil maksimal.</p>
                        </div>
                    </div>
                `;
                alertContainer.classList.remove('hidden');
            } else {
                alertContainer.classList.add('hidden');
                alertContainer.innerHTML = '';
            }

            const previewContainer = document.getElementById('detail-preview-buttons');
            previewContainer.innerHTML = '';
            
            const titleLabel = document.createElement('h3');
            titleLabel.className = "text-xs font-bold text-wa-gray uppercase tracking-wider mb-3 col-span-full flex items-center gap-2";
            titleLabel.innerHTML = "<span class='w-1 h-3 bg-wa-teal rounded-full'></span> Lihat <span class='text-wa-teal'>Live Pre</span>view";
            previewContainer.appendChild(titleLabel);

            const buttonsWrapper = document.createElement('div');
            buttonsWrapper.className = "flex flex-col gap-2";
            previewContainer.appendChild(buttonsWrapper);
            
            const baseUrl = item.link.replace(/\/$/, ""); 
            const sortOrder = ['foto', 'animasi', 'no-foto'];
            
            const sortedVariants = (item.variants || [])
                .filter(v => ['foto', 'animasi', 'no-foto'].includes(v))
                .sort((a,b) => sortOrder.indexOf(a) - sortOrder.indexOf(b));

            if (sortedVariants.length === 0) {
                createPreviewButton(buttonsWrapper, item.link, "Preview Undangan", "default", true);
            } else if (sortedVariants.length === 1) {
                const variant = sortedVariants[0];
                const d = getVariantDetails(variant, item, sortedVariants);
                createPreviewButton(buttonsWrapper, d.url, "Preview " + d.label, d.icon, true);
            } else if (sortedVariants.length === 2) {
                const grid = document.createElement('div');
                grid.className = "grid grid-cols-2 gap-2";
                buttonsWrapper.appendChild(grid);
                sortedVariants.forEach(v => {
                    const d = getVariantDetails(v, item, sortedVariants);
                    createPreviewButton(grid, d.url, d.label, d.icon, false);
                });
            } else {
                const v1 = sortedVariants[0];
                const d1 = getVariantDetails(v1, item, sortedVariants);
                createPreviewButton(buttonsWrapper, d1.url, "Preview " + d1.label, d1.icon, true);

                const grid = document.createElement('div');
                grid.className = "grid grid-cols-2 gap-2";
                buttonsWrapper.appendChild(grid);

                for(let i=1; i<sortedVariants.length; i++) {
                    const v = sortedVariants[i];
                    const d = getVariantDetails(v, item, sortedVariants);
                    createPreviewButton(grid, d.url, d.label, d.icon, false);
                }
            }

            const variantContainer = document.getElementById('detail-variants');
            variantContainer.innerHTML = '';
            if(item.variants && item.variants.length > 0) {
                item.variants.forEach(v => {
                    variantContainer.innerHTML += `<a href="${getVariantDetails(v, item, item.variants).url}" target="_blank" class="text-[11px] bg-wa-header border border-wa-divider text-wa-teal hover:text-white hover:bg-wa-teal hover:border-wa-teal px-3 py-1.5 rounded-lg capitalize tracking-wide shadow-sm transition-all duration-200 flex items-center gap-1">
                        ${v.replace('-', ' ')} <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>`;
                });
            } else {
                variantContainer.innerHTML = '<span class="text-xs text-wa-gray italic">Tidak ada info fitur khusus</span>';
            }

            // --- RENDER CAPSULE FEATURES ---
            const featuresContainer = document.getElementById('detail-features');
            featuresContainer.innerHTML = '';
            
            FEATURES_DB.forEach(f => {
                if (item.tier === 'Starter' && (f.id === 'gallery' || f.id === 'animasi')) return;

                const chip = document.createElement('button');
                chip.className = "border border-wa-divider bg-wa-header px-3 py-1.5 rounded-full text-[11px] text-wa-light flex items-center gap-2 hover:border-wa-teal/50 hover:bg-[#2a373f] transition active:scale-95";
                chip.onclick = () => openFeatureSheet(f);
                chip.innerHTML = `
                    <svg class="w-3.5 h-3.5 text-wa-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${f.icon}"></path></svg>
                    ${f.title}
                `;
                featuresContainer.appendChild(chip);
            });

            // --- RENDER SLIDER THUMBNAILS (HORIZONTAL) ---
            const slider = document.getElementById('detail-slider');
            slider.innerHTML = '';

            requestAnimationFrame(() => {
                slider.scrollLeft = 0;
            });

            for (let i = 1; i <= 10; i++) {
                const num = String(i).padStart(2, '0');
                let imgUrl = (i <= 8) ? `${IMAGEKIT_BASE}/${item.folder_id}/${num}.png` : `${IMAGEKIT_BASE}/feature-service/${num}.png`;
                imgUrl += "?tr=w-400"; // Low res for thumb
                
                const slideItem = document.createElement('div');
                slideItem.className = "snap-center shrink-0 w-[85%] h-full flex items-center justify-center bg-wa-header rounded-xl overflow-hidden relative border border-wa-divider cursor-pointer shadow-lg active:scale-[0.98] transition-transform";
                slideItem.onclick = () => openGallery(); 
                slideItem.innerHTML = `<img src="${imgUrl}" class="w-full h-full object-cover" loading="${i===1?'eager':'lazy'}" onerror="this.src='https://placehold.co/400x500/333?text=Slide+Error'">`;
                slider.appendChild(slideItem);
            }

            const progressBar = document.getElementById('slider-progress');
            slider.onscroll = () => {
                const maxScroll = slider.scrollWidth - slider.clientWidth;
                const scrollPct = (slider.scrollLeft / maxScroll) * 100;
                progressBar.style.width = Math.max(10, scrollPct) + "%";
            };
            progressBar.style.width = "10%";
        }

        // --- FEATURE SHEET FUNCTIONS ---
        function openFeatureSheet(feature) {
            document.getElementById('sheet-title').innerText = feature.title;
            document.getElementById('sheet-desc').innerText = feature.desc;
            document.getElementById('sheet-icon').innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${feature.icon}"></path></svg>`;
            
            const sheet = document.getElementById('feature-sheet');
            const backdrop = document.getElementById('feature-backdrop');
            
            backdrop.classList.remove('backdrop-closed');
            backdrop.classList.add('backdrop-open');
            sheet.classList.remove('sheet-closed');
            sheet.classList.add('sheet-open');
        }

        function closeFeatureSheet() {
            const sheet = document.getElementById('feature-sheet');
            const backdrop = document.getElementById('feature-backdrop');
            
            sheet.classList.remove('sheet-open');
            sheet.classList.add('sheet-closed');
            backdrop.classList.remove('backdrop-open');
            backdrop.classList.add('backdrop-closed');
        }

        function getVariantDetails(variant, item, allVariants) {
            const baseUrl = item.link.replace(/\/$/, ""); 
            let url = item.link;
            let label = "Preview";
            let icon = "default";

            if (variant === 'foto') {
                url = item.link;
                label = "Versi Foto";
                icon = "camera";
            } else if (variant === 'animasi') {
                url = allVariants.length > 1 ? baseUrl + "-animasi" : item.link;
                label = "Versi Animasi";
                icon = "play";
            } else if (variant === 'no-foto') {
                url = allVariants.length > 1 ? baseUrl + "-tanpa-foto" : item.link;
                label = "Tanpa Foto";
                icon = "doc";
            }
            return { url, label, icon };
        }

        // --- NEW VERTICAL SCROLL GALLERY ---
        function openGallery() {
            const item = window.currentGalleryItem;
            if(!item) return;

            const galleryView = document.getElementById('view-gallery');
            const container = document.getElementById('gallery-container');
            container.innerHTML = '';
            
            // Reset scroll to top
            container.scrollTop = 0;

            for (let i = 1; i <= 10; i++) {
                const num = String(i).padStart(2, '0');
                let imgUrl = (i <= 8) ? `${IMAGEKIT_BASE}/${item.folder_id}/${num}.png` : `${IMAGEKIT_BASE}/feature-service/${num}.png`;
                // REVISION 1: Kembalikan resolusi ke 800px agar tidak lag
                imgUrl += "?tr=w-800"; 

                // Wrapper div tidak lagi pakai snap, tapi flow biasa (block)
                // Width full, height auto mengikuti rasio gambar
                const img = document.createElement('img');
                img.src = imgUrl;
                img.className = "w-full h-auto block mb-0"; 
                img.loading = "lazy";
                
                // Tambahkan placeholder loading
                img.style.minHeight = "200px";
                img.style.background = "#111";
                
                container.appendChild(img);
            }

            galleryView.classList.remove('gallery-closed');
            galleryView.classList.add('gallery-open');
        }

        function closeGallery() {
            const galleryView = document.getElementById('view-gallery');
            galleryView.classList.remove('gallery-open');
            galleryView.classList.add('gallery-closed');
        }

        function scrollSlider(direction) {
            const slider = document.getElementById('detail-slider');
            const scrollAmount = slider.offsetWidth * 0.85; 
            slider.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });
        }

        function createPreviewButton(container, url, text, iconType, isPrimary = false) {
            let iconSvg = '';
            if (iconType === 'camera') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
            // Couple Icon for Animation
            else if (iconType === 'play') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>';
            else if (iconType === 'doc') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>';
            else iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>';

            const btn = document.createElement('a');
            btn.href = url;
            btn.target = "_blank";
            
            let classes = "relative overflow-hidden group border border-wa-divider rounded-xl hover:border-wa-teal transition-all active:scale-[0.98] ";
            
            if (isPrimary) {
                classes += "bg-[#202c33] p-4 flex items-center justify-center gap-3 w-full shadow-md";
                btn.innerHTML = `
                    <div class="text-wa-teal group-hover:text-white transition-colors">${iconSvg}</div>
                    <span class="text-sm font-bold text-wa-light tracking-wide uppercase group-hover:text-white">${text}</span>
                    <div class="absolute inset-0 bg-wa-teal/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                `;
            } else {
                // Horizontal secondary buttons
                classes += "bg-[#2a373f] p-4 flex flex-row items-center justify-center gap-3 w-full shadow-sm";
                btn.innerHTML = `
                    <div class="text-wa-teal/80 group-hover:text-white transition-colors scale-90">${iconSvg}</div>
                    <span class="text-xs font-medium text-wa-gray group-hover:text-wa-light text-center leading-tight">${text}</span>
                `;
            }
            
            btn.className = classes;
            container.appendChild(btn);
        }

        function kirimPesanWA() {
            if(!window.currentItem) return;
            const item = window.currentItem;
            const price = item.price_real.toLocaleString('id-ID');
            const text = `Halo kak üëã\nSaya ingin pesan tema *${item.title}* (Paket ${item.tier}).\nApakah betul harganya Rp. ${price}?`;
            const url = `https://wa.me/6285117173637?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        window.onload = loadData;

    </script>
</body>
</html>
