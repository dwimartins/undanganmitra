<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Katalog Undangan Digital (Reseller)</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. FIREBASE COMPAT -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wa: {
                            bg: '#111b21',       /* Background Utama Gelap */
                            header: '#202c33',   /* Header/Card Background */
                            button: '#2a373f',   /* Button Lighter */
                            teal: '#00a884',     /* Hijau WA */
                            light: '#e9edef',    /* Teks Utama */
                            gray: '#8696a0',     /* Teks Secondary */
                            divider: '#222d36'   /* Garis Pembatas */
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'shimmer': 'shimmer 2s linear infinite',
                        'fade-up': 'fadeUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' }
                        },
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #111b21; color: #e9edef; -webkit-tap-highlight-color: transparent; }
        
        /* NOISE TEXTURE & GLOW BACKGROUND */
        .bg-noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        .bg-glow {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
            background: radial-gradient(circle at 50% 0%, rgba(0, 168, 132, 0.06), transparent 80%);
        }

        /* Custom Scrollbar */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth Scrolling */
        .smooth-scroll {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
        }

        .touch-allow-all { touch-action: pan-x pan-y; }
        .snap-x { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }
        
        /* View Transitions */
        .view-section { display: none; animation: fadeIn 0.2s ease-out; position: relative; z-index: 1; }
        .view-active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Sheet & Gallery Animations */
        #view-gallery, #feature-sheet, #order-sheet, #animasi-sheet { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; }
        .sheet-open { transform: translateY(0); }
        .sheet-closed { transform: translateY(100%); }
        .backdrop-open { opacity: 1; pointer-events: auto; }
        .backdrop-closed { opacity: 0; pointer-events: none; }
        
        .gallery-open { opacity: 1; pointer-events: auto; transform: scale(1); }
        .gallery-closed { opacity: 0; pointer-events: none; transform: scale(0.95); }

        /* Smart Header */
        #smart-header { transition: transform 0.3s ease-in-out, opacity 0.3s ease; }
        .header-hidden { transform: translateY(-100%); opacity: 0; pointer-events: none; }
        .header-visible { transform: translateY(0); opacity: 1; pointer-events: auto; }

        /* Grid 3D Effect Enhanced */
        .grid-3d {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .grid-3d:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
        .grid-3d:active { transform: translateY(1px); box-shadow: none; }

        /* Grid Colors with Gradients */
        .bg-gradient-gold { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(234, 179, 8, 0.15) 100%); }
        .bg-gradient-cyan { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(34, 211, 238, 0.15) 100%); }
        .bg-gradient-blue { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(59, 130, 246, 0.15) 100%); }
        .bg-gradient-purple { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(168, 85, 247, 0.15) 100%); }
        .bg-gradient-red { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(239, 68, 68, 0.15) 100%); }
        .bg-gradient-yellow { background: linear-gradient(145deg, rgba(32, 44, 51, 1) 0%, rgba(250, 204, 21, 0.15) 100%); }

        .hover-shadow-gold:hover { border-color: rgba(234, 179, 8, 0.5); }
        .hover-shadow-cyan:hover { border-color: rgba(34, 211, 238, 0.5); }
        .hover-shadow-blue:hover { border-color: rgba(59, 130, 246, 0.5); }
        .hover-shadow-purple:hover { border-color: rgba(168, 85, 247, 0.5); }
        .hover-shadow-red:hover { border-color: rgba(239, 68, 68, 0.5); }
        .hover-shadow-yellow:hover { border-color: rgba(250, 204, 21, 0.5); }

        /* Badge Shimmer Effect */
        .badge-shine { position: relative; overflow: hidden; }
        .badge-shine::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
            transform: skewX(-20deg) translateX(-150%);
            animation: shimmer 3s infinite;
        }
    </style>
</head>

<body class="antialiased min-h-screen pb-20 bg-[#0b141a]">
    
    <!-- BACKGROUND EFFECTS -->
    <div class="bg-noise"></div>
    <div class="bg-glow"></div>

    <!-- VIEW 1: HOME -->
    <div id="view-home" class="view-section view-active bg-transparent min-h-screen">
        <!-- Smart Header -->
        <div id="smart-header" class="fixed top-0 left-0 right-0 z-50 bg-wa-header/95 backdrop-blur-md shadow-md border-b border-wa-divider header-hidden">
            <div class="max-w-md mx-auto px-4 h-16 flex items-center gap-3 overflow-x-auto hide-scroll">
                <button onclick="scrollToTop()" class="flex items-center gap-2 bg-wa-teal text-white px-4 py-2 rounded-full text-xs font-bold shrink-0 shadow-lg shadow-wa-teal/20 transition active:scale-95">
                    <span id="header-cat-icon">üíç</span>
                    <span id="header-cat-text">Wedding</span>
                </button>
                <button onclick="openSheet('order-sheet')" class="flex items-center gap-2 bg-[#2a373f] text-wa-light border border-wa-divider px-4 py-2 rounded-full text-xs font-medium shrink-0 hover:bg-[#374248] transition active:scale-95">
                    <svg class="w-4 h-4 text-wa-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                    Cara Order
                </button>
                <button onclick="openSheet('animasi-sheet')" class="relative flex items-center gap-2 bg-[#2a373f] text-wa-light border border-wa-divider px-4 py-2 rounded-full text-xs font-medium shrink-0 hover:bg-[#374248] transition active:scale-95">
                    <svg class="w-4 h-4 text-wa-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                    Animasi
                    <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                </button>
            </div>
        </div>

        <!-- Hero -->
        <div class="relative w-full h-[450px] overflow-hidden border-b border-wa-divider/50 group bg-wa-bg">
            <div class="absolute inset-0 max-w-md mx-auto relative h-full">
                <img src="https://ik.imagekit.io/undangandigital/general/hero.webp" class="w-full h-full object-cover opacity-50 transition-transform duration-1000 group-hover:scale-105" alt="Hero Banner">
                <div class="absolute inset-0 bg-gradient-to-t from-wa-bg via-wa-bg/80 to-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-wa-bg/40 to-transparent"></div>
                
                <div class="absolute inset-0 flex flex-col justify-end items-center text-center px-6 pb-12 z-10">
                    <div class="mb-4 animate-[fadeIn_0.8s_ease-out]">
                        <span class="inline-block py-1 px-3 rounded-full bg-wa-teal/10 border border-wa-teal/30 text-wa-teal text-[10px] font-bold tracking-widest uppercase mb-3 backdrop-blur-sm">Premium Collection</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-white leading-tight mb-2 tracking-tight">Undangan Digital <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-teal-300 to-emerald-500">Eksklusif & Modern</span></h2>
                        <p class="text-wa-gray text-xs md:text-sm max-w-md mx-auto leading-relaxed mt-2">Temukan berbagai undangan premium dengan desain eksklusif.</p>
                    </div>
                    <button onclick="kirimPesanUmum()" class="bg-wa-teal text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-wa-teal/30 text-sm flex items-center gap-2 hover:bg-[#008f6f] active:scale-95 transition-all animate-[fadeIn_1s_ease-out_0.3s_both]">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                        Konsultasi Custom Design
                    </button>
                </div>
            </div>
        </div>

        <!-- Grid Menu (Gradients) -->
        <div id="grid-menu" class="max-w-md mx-auto px-4 py-8 relative z-10">
            <div class="mb-6 flex justify-between items-end">
                <div>
                    <h3 class="text-xl font-bold text-wa-light">Telusuri Kategori</h3>
                    <p class="text-xs text-wa-gray mt-1">Pilih jenis acara yang kamu inginkan</p>
                </div>
                <div class="h-1 w-10 bg-wa-teal rounded-full"></div>
            </div>
            <div class="grid grid-cols-3 gap-3">
                <div onclick="selectCategory('Wedding')" class="grid-3d hover-shadow-gold bg-gradient-gold group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-yellow-500 transition-colors shadow-lg">üíç</div>
                    <span class="text-[9px] md:text-[10px] font-bold text-white uppercase tracking-widest group-hover:text-yellow-500 transition-colors">WEDDING</span>
                </div>
                <div onclick="selectCategory('Kids')" class="grid-3d hover-shadow-cyan bg-gradient-cyan group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-cyan-400 transition-colors shadow-lg">üéà</div>
                    <span class="text-[9px] md:text-[10px] font-bold text-white uppercase tracking-widest group-hover:text-cyan-400 transition-colors">ACARA ANAK</span>
                </div>
                <div onclick="selectCategory('Formal')" class="grid-3d hover-shadow-blue bg-gradient-blue group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-blue-500 transition-colors shadow-lg">üè¢</div>
                    <span class="text-[9px] md:text-[10px] font-bold text-white uppercase tracking-widest group-hover:text-blue-500 transition-colors">ACARA FORMAL</span>
                </div>
                <div onclick="selectCategory('Teen')" class="grid-3d hover-shadow-purple bg-gradient-purple group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-purple-500 transition-colors shadow-lg">üé∏</div>
                    <span class="text-[9px] md:text-[10px] font-bold text-white uppercase tracking-widest group-hover:text-purple-500 transition-colors">TEEN & CARD</span>
                </div>
                <div onclick="selectCategory('School')" class="grid-3d hover-shadow-red bg-gradient-red group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-red-500 transition-colors shadow-lg">üéì</div>
                    <span class="text-[8px] md:text-[9px] font-bold text-white uppercase tracking-widest group-hover:text-red-500 transition-colors leading-tight">SCHOOL & GRADUATION</span>
                </div>
                <div onclick="selectCategory('Lainnya')" class="grid-3d hover-shadow-yellow bg-gradient-yellow group cursor-pointer rounded-xl p-3 flex flex-col items-center justify-center text-center aspect-[4/3]">
                    <div class="w-10 h-10 rounded-full bg-[#111b21] flex items-center justify-center text-xl mb-3 text-white border border-white/5 group-hover:text-yellow-400 transition-colors shadow-lg">üìÇ</div>
                    <span class="text-[9px] md:text-[10px] font-bold text-white uppercase tracking-widest group-hover:text-yellow-400 transition-colors">ACARA LAINNYA</span>
                </div>
            </div>
        </div>
        
        <!-- Divider -->
        <div class="max-w-md mx-auto px-4 mt-6 mb-8">
            <div class="bg-[#182329]/80 backdrop-blur-md border border-wa-divider rounded-2xl p-6 text-center relative overflow-hidden shadow-lg">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-wa-teal/50 to-transparent"></div>
                <div class="absolute -left-4 -top-4 w-16 h-16 bg-wa-teal/10 rounded-full blur-xl"></div>
                <div class="absolute -right-4 -bottom-4 w-16 h-16 bg-wa-teal/10 rounded-full blur-xl"></div>
                <div class="relative z-10">
                    <span id="collection-badge" class="inline-block py-1 px-3 rounded-full bg-wa-teal/10 text-wa-teal text-[10px] font-bold tracking-[0.2em] uppercase mb-3 border border-wa-teal/20">Exclusive Series</span>
                    <h2 id="collection-title" class="text-2xl font-serif italic text-white leading-tight mb-2 drop-shadow-sm">Wedding Collections</h2>
                    <p id="collection-desc" class="text-xs text-wa-gray font-light tracking-wide max-w-[240px] mx-auto leading-relaxed">Temukan desain undangan pernikahan impian Anda dengan kualitas terbaik di sini.</p>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="home-loading" class="max-w-md mx-auto p-4 space-y-8">
            <div class="space-y-3">
                <div class="h-6 w-32 bg-wa-header rounded animate-pulse"></div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="aspect-[4/5] bg-wa-header rounded-xl animate-pulse"></div>
                    <div class="aspect-[4/5] bg-wa-header rounded-xl animate-pulse"></div>
                </div>
            </div>
        </div>
        
        <!-- Error -->
        <div id="error-message" class="hidden max-w-md mx-auto p-6 text-center">
            <div class="bg-red-900/30 border border-red-500/50 text-red-200 p-4 rounded-xl">
                <p class="font-bold text-sm">Gagal Memuat Data</p>
                <p id="error-text" class="text-xs mt-1 opacity-80">Periksa koneksi internet Anda.</p>
                <button onclick="location.reload()" class="mt-3 bg-red-600 px-4 py-2 rounded-lg text-xs font-bold">Coba Lagi</button>
            </div>
        </div>

        <!-- TIER LIST CONTAINER -->
        <div id="tier-list-container" class="max-w-md mx-auto pb-10 space-y-6"></div>

        <!-- Custom Design Section -->
        <div class="max-w-md mx-auto px-4 pb-8 mt-8">
            <div class="relative bg-gradient-to-br from-[#182329] to-[#0b141a] border border-wa-teal/30 rounded-2xl p-6 text-center overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-wa-teal/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-purple-500/10 rounded-full blur-2xl -ml-12 -mb-12 pointer-events-none"></div>
                <div class="relative z-10">
                    <div class="w-12 h-12 mx-auto bg-[#202c33] rounded-full flex items-center justify-center mb-3 border border-wa-teal/50 shadow-[0_0_15px_rgba(0,168,132,0.3)]"><svg class="w-6 h-6 text-wa-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div>
                    <h3 class="text-lg font-bold text-white mb-2">Ingin Desain Lebih Exclusive?</h3>
                    <p class="text-xs text-wa-gray mb-4 leading-relaxed">Mau undangan yang belum pernah dipakai orang lain? Kamu bisa order <span class="text-wa-teal font-semibold">Custom Design</span> spesial sesuai keinginanmu.</p>
                    <button onclick="kirimPesanCustom()" class="inline-flex items-center gap-2 bg-wa-teal hover:bg-[#008f6f] text-white text-xs font-bold px-6 py-3 rounded-full transition-all shadow-lg active:scale-95"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.017-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>Konsultasi Gratis</button>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 2: CATEGORY FULL -->
    <div id="view-category" class="view-section bg-wa-bg min-h-screen">
        <div class="sticky top-0 z-40 bg-gradient-to-r from-wa-header to-[#102924] shadow-md border-b border-wa-divider">
            <div class="px-2 h-14 flex items-center gap-3 max-w-md mx-auto">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-white/5 transition">
                    <svg class="w-6 h-6 text-wa-light" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <div>
                    <h1 id="cat-header-title" class="font-bold text-base text-wa-light leading-tight">Nama Kategori</h1>
                    <p id="cat-header-count" class="text-[10px] text-wa-teal font-medium tracking-wide">0 Tema Tersedia</p>
                </div>
            </div>
        </div>
        <div id="cat-grid-container" class="max-w-md mx-auto p-3 grid grid-cols-2 gap-3"></div>
    </div>

    <!-- VIEW 3: DETAIL PRODUCT -->
    <div id="view-detail" class="view-section bg-wa-bg min-h-screen">
        <div class="fixed top-0 w-full z-50 max-w-md mx-auto left-0 right-0 pointer-events-none">
            <div class="flex justify-between items-center p-4 bg-gradient-to-b from-black/70 to-transparent">
                <button onclick="goBack()" class="bg-black/30 backdrop-blur-md p-2 rounded-full text-white hover:bg-black/50 transition pointer-events-auto border border-white/10">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
            </div>
        </div>
        <div class="max-w-md mx-auto relative bg-black group">
            <div class="w-full aspect-square relative overflow-hidden">
                <div id="detail-slider" class="flex overflow-x-auto snap-x snap-mandatory hide-scroll h-full items-center px-4 gap-3 smooth-scroll touch-allow-all"></div>
                <div class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="bg-black/50 backdrop-blur px-3 py-1 rounded-full border border-white/20"><span class="text-white text-xs font-medium">Klik untuk memperbesar</span></div>
                </div>
                <button onclick="scrollSlider(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/40 backdrop-blur-md p-2 rounded-full text-white border border-white/10 hover:bg-black/60 transition z-10"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                <button onclick="scrollSlider(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/40 backdrop-blur-md p-2 rounded-full text-white border border-white/10 hover:bg-black/60 transition z-10 animate-pulse"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
            </div>
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-white/10"><div id="slider-progress" class="h-full bg-wa-teal transition-all duration-300 w-[10%] shadow-[0_0_10px_rgba(0,168,132,0.5)]"></div></div>
        </div>
        <div class="max-w-md mx-auto bg-wa-bg p-5 pb-24">
            <div class="border-b border-wa-divider pb-5 mb-5">
                <div class="flex justify-between items-start">
                    <h1 id="detail-title" class="text-xl font-bold text-wa-light leading-snug tracking-tight"></h1>
                    <span id="detail-category" class="text-[10px] font-bold text-wa-teal bg-wa-teal/10 border border-wa-teal/20 px-2.5 py-1 rounded-full uppercase tracking-wider ml-2 shrink-0">Wedding</span>
                </div>
                
                <!-- PRICE CONTAINER (Diberi ID agar mudah di hide via JS) -->
                <div id="detail-price-container" class="mt-3 flex items-center gap-3">
                    <span id="detail-price-real" class="text-2xl font-bold text-wa-light"></span>
                    <span id="detail-price-fake" class="text-sm text-wa-gray line-through decoration-red-500/50 decoration-2"></span>
                </div>

                <div id="detail-preview-buttons" class="mt-6"></div>
            </div>
            <div class="space-y-3">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest flex items-center gap-2"><span class="w-1 h-4 bg-wa-teal rounded-full"></span>Deskripsi Item</h3>
                <p id="detail-desc" class="text-sm text-wa-light leading-relaxed whitespace-pre-line"></p>
            </div>
            <div id="detail-photo-alert" class="mt-6 hidden"></div>
            
            <!-- SECTION VARIAN TEMA (Diberi ID agar bisa di-hide via JS) -->
            <div id="section-variants-wrapper" class="mt-8 pt-5 border-t border-wa-divider">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-wa-teal rounded-full"></span>VARIAN TEMA</h3>
                <div id="detail-variants" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="mt-8 pt-5 border-t border-wa-divider">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest mb-4 flex items-center gap-2"><span class="w-1 h-4 bg-wa-teal rounded-full"></span>FITUR LENGKAP</h3>
                <div id="detail-features" class="flex flex-wrap gap-2"></div>
            </div>
            <div class="mt-8 pt-5 border-t border-wa-divider">
                <h3 class="text-xs font-bold text-wa-gray uppercase tracking-widest mb-1 flex items-center gap-2"><span class="w-1 h-4 bg-wa-teal rounded-full"></span>EXTRA SERVICES</h3>
                <p class="text-[10px] text-wa-gray/80 italic mb-4 ml-3">Janji Kami Buat Kamu!</p>
                <div id="detail-extra-services" class="flex flex-wrap gap-2"></div>
            </div>
        </div>
        
        <!-- FIXED BOTTOM BUTTON: REVISI - Menjadi Lihat Preview Tema -->
        <div class="fixed bottom-0 w-full bg-wa-header/95 backdrop-blur-md border-t border-wa-divider p-3 z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.2)]">
            <div class="max-w-md mx-auto flex gap-3">
                <button onclick="openMainPreview()" class="flex-1 bg-wa-teal text-white font-bold py-3.5 rounded-full shadow-lg shadow-wa-teal/20 text-sm flex justify-center items-center gap-2 hover:bg-[#008f6f] active:scale-[0.98] transition group">
                    <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    Lihat Preview Tema
                </button>
            </div>
        </div>
    </div>

    <!-- SHEETS & MODALS -->
    <!-- REVISI 3: Galeri Fokus Slider dengan Navigasi dan Progress Bar -->
    <div id="view-gallery" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-sm gallery-closed flex flex-col">
        <!-- Tombol Close Standalone di Pojok Kanan Atas -->
        <button onclick="closeGallery()" class="absolute top-5 right-5 z-[110] bg-black/40 hover:bg-black/80 text-white p-2.5 rounded-full backdrop-blur-md border border-white/20 transition active:scale-90 flex items-center justify-center shadow-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <!-- Tampilan Foto Mode Fokus -->
        <div class="flex-1 w-full h-full flex items-center justify-center relative overflow-hidden">
            <!-- Navigasi Kiri -->
            <button onclick="changeGalleryImage(-1)" class="absolute left-3 top-1/2 -translate-y-1/2 z-20 bg-black/40 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-md border border-white/10 transition active:scale-90 flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            
            <!-- Area Gambar Utama -->
            <div class="w-full h-full p-4 pb-20 flex items-center justify-center relative z-10">
                <img id="gallery-main-image" src="" alt="Gallery Image" class="max-w-full max-h-full object-contain drop-shadow-2xl transition-opacity duration-200 opacity-0">
            </div>

            <!-- Navigasi Kanan -->
            <button onclick="changeGalleryImage(1)" class="absolute right-3 top-1/2 -translate-y-1/2 z-20 bg-black/40 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-md border border-white/10 transition active:scale-90 flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
        </div>

        <!-- Progress Bar Elegan -->
        <div class="absolute bottom-8 left-0 right-0 px-6 flex flex-col items-center gap-3 z-30 pointer-events-none">
            <span id="gallery-counter" class="bg-black/60 text-white text-[10px] px-4 py-1.5 rounded-full backdrop-blur border border-white/10 font-bold tracking-[0.2em] shadow-lg">1 / 10</span>
            <div class="w-full max-w-xs h-1.5 bg-white/20 rounded-full overflow-hidden">
                <div id="gallery-progress" class="h-full bg-wa-teal transition-all duration-300 w-[10%] shadow-[0_0_10px_rgba(0,168,132,0.5)]"></div>
            </div>
        </div>
    </div>

    <div id="backdrop-order-sheet" onclick="closeSheet('order-sheet')" class="fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm backdrop-closed transition-opacity duration-300 hidden"></div>
    <div id="order-sheet" class="fixed bottom-0 left-0 right-0 z-[61] bg-[#202c33] rounded-t-[2rem] p-6 sheet-closed border-t border-wa-divider shadow-2xl max-w-md mx-auto">
        <div class="w-12 h-1.5 bg-wa-divider rounded-full mx-auto mb-6"></div>
        <h3 class="text-xl font-bold text-white mb-6 text-center">üìú Cara Pemesanan</h3>
        <div class="space-y-4">
            <div class="flex items-start gap-4"><div class="w-8 h-8 rounded-full bg-wa-teal text-white flex items-center justify-center font-bold text-sm shrink-0">1</div><div><h4 class="text-sm font-bold text-white">Pilih Desain</h4><p class="text-xs text-wa-gray leading-relaxed">Pilih tema undangan yang kamu suka dari katalog kami.</p></div></div>
            <div class="flex items-start gap-4"><div class="w-8 h-8 rounded-full bg-wa-teal text-white flex items-center justify-center font-bold text-sm shrink-0">2</div><div><h4 class="text-sm font-bold text-white">Klik Tombol Pesan</h4><p class="text-xs text-wa-gray leading-relaxed">Klik tombol "Pesan via WhatsApp" di bagian bawah layar.</p></div></div>
            <div class="flex items-start gap-4"><div class="w-8 h-8 rounded-full bg-wa-teal text-white flex items-center justify-center font-bold text-sm shrink-0">3</div><div><h4 class="text-sm font-bold text-white">Isi Data</h4><p class="text-xs text-wa-gray leading-relaxed">Admin akan mengirimkan formulir data mempelai untuk diisi.</p></div></div>
            <div class="flex items-start gap-4"><div class="w-8 h-8 rounded-full bg-wa-teal text-white flex items-center justify-center font-bold text-sm shrink-0">4</div><div><h4 class="text-sm font-bold text-white">Proses Pengerjaan</h4><p class="text-xs text-wa-gray leading-relaxed">Undangan akan diproses 1-2 hari kerja setelah data lengkap.</p></div></div>
        </div>
        <button onclick="kirimPesanUmum()" class="mt-8 w-full bg-wa-teal py-3.5 rounded-xl text-sm font-bold text-white hover:bg-[#008f6f] transition shadow-lg">Chat Admin Sekarang</button>
    </div>

    <div id="backdrop-animasi-sheet" onclick="closeSheet('animasi-sheet')" class="fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm backdrop-closed transition-opacity duration-300 hidden"></div>
    <div id="animasi-sheet" class="fixed bottom-0 left-0 right-0 z-[61] bg-[#202c33] rounded-t-[2rem] p-6 sheet-closed border-t border-wa-divider shadow-2xl max-w-md mx-auto max-h-[85vh] overflow-y-auto hide-scroll">
        <div class="w-12 h-1.5 bg-wa-divider rounded-full mx-auto mb-6"></div>
        <div class="text-center mb-6">
            <span class="inline-block px-3 py-1 bg-wa-teal/10 text-wa-teal text-[10px] font-bold rounded-full mb-3 border border-wa-teal/20 tracking-wider">ANIMASI DIGITAL GRATIS</span>
            <h3 class="text-xl font-bold text-white leading-tight">‚ú® Kabar Gembira Untukmu</h3>
            <p class="text-xs text-wa-gray mt-2 leading-relaxed max-w-[280px] mx-auto">Buat kamu yang gak sempat foto prewed ataupun yang gak mau nampilin foto pribadimu, kami menyediakan ratusan karakter animasi digital yang bisa kamu pakai secara gratis untuk ditampilkan di undanganmu.</p>
        </div>
        
        <!-- Grid Karakter -->
        <div class="grid grid-cols-2 gap-4 mb-8">
            <!-- Jawa -->
            <div class="relative bg-[#111b21] rounded-2xl overflow-hidden border border-wa-divider group hover:border-wa-teal/50 transition duration-300">
                <div class="h-36 w-full relative flex items-end justify-center pt-4">
                    <!-- Background Glow Effect -->
                    <div class="absolute inset-0 bg-gradient-to-t from-wa-teal/20 via-transparent to-transparent opacity-50"></div>
                    <div class="absolute bottom-0 w-24 h-24 bg-wa-teal/20 blur-2xl rounded-full"></div>
                    <!-- Image -->
                    <img src="https://ik.imagekit.io/undangandigital/popup-animasi/jawa.png?tr=w-300" 
                         class="h-full object-contain relative z-10 drop-shadow-xl transition-transform duration-500 group-hover:scale-105" 
                         alt="Adat Jawa">
                </div>
                <div class="p-3 bg-[#182329] border-t border-wa-divider relative z-20">
                    <h4 class="text-xs font-bold text-wa-light text-center">Adat Jawa</h4>
                </div>
            </div>

            <!-- Batak -->
            <div class="relative bg-[#111b21] rounded-2xl overflow-hidden border border-wa-divider group hover:border-wa-teal/50 transition duration-300">
                <div class="h-36 w-full relative flex items-end justify-center pt-4">
                    <div class="absolute inset-0 bg-gradient-to-t from-red-500/10 via-transparent to-transparent opacity-50"></div>
                    <div class="absolute bottom-0 w-24 h-24 bg-red-500/10 blur-2xl rounded-full"></div>
                    <img src="https://ik.imagekit.io/undangandigital/popup-animasi/batak.png?tr=w-300" 
                         class="h-full object-contain relative z-10 drop-shadow-xl transition-transform duration-500 group-hover:scale-105" 
                         alt="Adat Batak">
                </div>
                <div class="p-3 bg-[#182329] border-t border-wa-divider relative z-20">
                    <h4 class="text-xs font-bold text-wa-light text-center">Adat Batak</h4>
                </div>
            </div>

            <!-- Burgundy -->
            <div class="relative bg-[#111b21] rounded-2xl overflow-hidden border border-wa-divider group hover:border-wa-teal/50 transition duration-300">
                <div class="h-36 w-full relative flex items-end justify-center pt-4">
                    <div class="absolute inset-0 bg-gradient-to-t from-rose-500/10 via-transparent to-transparent opacity-50"></div>
                    <div class="absolute bottom-0 w-24 h-24 bg-rose-500/10 blur-2xl rounded-full"></div>
                    <img src="https://ik.imagekit.io/undangandigital/popup-animasi/burgundy.png?tr=w-300" 
                         class="h-full object-contain relative z-10 drop-shadow-xl transition-transform duration-500 group-hover:scale-105" 
                         alt="Modern Burgundy">
                </div>
                <div class="p-3 bg-[#182329] border-t border-wa-divider relative z-20">
                    <h4 class="text-xs font-bold text-wa-light text-center">Modern Burgundy</h4>
                </div>
            </div>

            <!-- Ungu -->
            <div class="relative bg-[#111b21] rounded-2xl overflow-hidden border border-wa-divider group hover:border-wa-teal/50 transition duration-300">
                <div class="h-36 w-full relative flex items-end justify-center pt-4">
                    <div class="absolute inset-0 bg-gradient-to-t from-purple-500/10 via-transparent to-transparent opacity-50"></div>
                    <div class="absolute bottom-0 w-24 h-24 bg-purple-500/10 blur-2xl rounded-full"></div>
                    <img src="https://ik.imagekit.io/undangandigital/popup-animasi/ungu.png?tr=w-300" 
                         class="h-full object-contain relative z-10 drop-shadow-xl transition-transform duration-500 group-hover:scale-105" 
                         alt="Modern Lilac">
                </div>
                <div class="p-3 bg-[#182329] border-t border-wa-divider relative z-20">
                    <h4 class="text-xs font-bold text-wa-light text-center">Modern Lilac</h4>
                </div>
            </div>
        </div>
        
<button onclick="window.location.href='https://dwimartins.github.io/undangan/animasi-digital/'" class="w-full bg-[#2a373f] py-4 rounded-xl text-sm font-bold text-wa-teal border border-wa-divider hover:bg-wa-divider transition flex items-center justify-center gap-2 group">
    Lihat 500+ Koleksi Lainnya
    <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
</button>

    </div>

    <div id="feature-backdrop" onclick="closeFeatureSheet()" class="fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm backdrop-closed transition-opacity duration-300"></div>
    <div id="feature-sheet" class="fixed bottom-0 left-0 right-0 z-[61] bg-[#202c33] rounded-t-[2rem] p-6 sheet-closed border-t border-wa-divider shadow-2xl max-w-md mx-auto">
        <div class="w-12 h-1.5 bg-wa-divider rounded-full mx-auto mb-6"></div>
        <div class="flex items-start gap-4">
            <div id="sheet-icon" class="bg-wa-teal/10 p-3 rounded-xl text-wa-teal shrink-0"></div>
            <div><h3 id="sheet-title" class="text-lg font-bold text-white mb-2"></h3><p id="sheet-desc" class="text-sm text-wa-gray leading-relaxed"></p></div>
        </div>
        <button onclick="closeFeatureSheet()" class="mt-8 w-full bg-wa-button py-3 rounded-xl text-sm font-medium text-wa-teal hover:bg-wa-divider transition">Tutup</button>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        // --- 1. DEFINISI DATA CONSTANT DI ATAS (AGAR AMAN) ---
        
        // !!! CONFIGURATION FOR RESELLER !!!
        const SHOW_PRICE = false; // Set TRUE untuk katalog pusat, Set FALSE untuk katalog reseller

        // ADD-ON FEATURES FOR FORMAL EVENTS
        const FORMAL_FEATURES_ADDONS = [
            { id: 'rundown', title: "Rundown Acara", icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z", desc: "Daftar susunan acara dari pembukaan hingga penutupan agar tamu mengetahui jadwal kegiatan." },
            { id: 'speakers', title: "Profil Pembicara", icon: "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z", desc: "Menampilkan foto dan bio singkat pembicara/narasumber untuk meningkatkan nilai jual acara." },
            { id: 'materials', title: "Download Materi", icon: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4", desc: "Link khusus jika acara tersebut menyediakan file materi atau e-sertifikat yang bisa diunduh tamu." },
            { id: 'sponsors', title: "Logo Partner", icon: "M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z", desc: "Section khusus untuk menampilkan logo-logo perusahaan partner atau sponsor yang bekerja sama." }
        ];

        // ADD-ON FEATURES FOR SCHOOL & GRADUATION
        const SCHOOL_FEATURES_ADDONS = [
            { id: 'rundown_school', title: "Susunan Acara", icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2", desc: "Jadwal lengkap prosesi wisuda/sidang dari pembukaan hingga penutupan untuk kelancaran acara." },
            { id: 'dresscode', title: "Dress Code", icon: "M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z", desc: "Informasi ketentuan busana (Toga/Batik/Formal) bagi wisudawan dan tamu undangan." },
            { id: 'rules', title: "Tata Tertib", icon: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z", desc: "Poin-poin protokol yang wajib dipatuhi tamu demi menjaga kekhidmatan prosesi sidang/wisuda." },
            { id: 'streaming', title: "Live Streaming", icon: "M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z", desc: "Tautan langsung ke YouTube/Zoom bagi keluarga atau kerabat yang hadir secara virtual." }
        ];
        
        // ADD-ON FEATURES FOR KIDS
        const KIDS_FEATURES_ADDONS = [
            { id: 'parents', title: "Profil Orang Tua", icon: "M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z", desc: "Menampilkan nama dan foto ayah bunda yang sedang berbahagia atas kelahiran/ulang tahun si kecil." },
             { id: 'dresscode_kids', title: "Dress Code", icon: "M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z", desc: "Info kostum atau warna baju (e.g. Superhero, Princess) agar pesta semakin meriah." }
        ];

        // ADD-ON FEATURES FOR TEEN
        const TEEN_FEATURES_ADDONS = [
             { id: 'dresscode_teen', title: "Dress Code", icon: "M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z", desc: "Info tema outfit (e.g. Superhero, Retro, Pastel, White) agar foto-foto kita makin aesthetic." }
        ];

        // ADD-ON FEATURES FOR OTHER
        const OTHER_FEATURES_ADDONS = [
            { id: 'rundown_general', title: "Susunan Acara", icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2", desc: "Informasi waktu dan agenda kegiatan agar tamu tidak ketinggalan momen penting." },
        ];


        // DATA FITUR LENGKAP
        const FEATURES_DB = [
            { id: 'guest', title: "Custom Nama Tamu", icon: "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z", desc: "Sebarkan undanganmu lebih personal dengan menulis nama mereka secara otomatis pada cover undangan." },
            { id: 'unlimited', title: "Unlimited Tamu", icon: "M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z", desc: "Kamu bisa kirim undanganmu kepada sebanyak mungkin tamu yang mau kamu undang tanpa biaya tambahan." },
            { id: 'music', title: "Autoplay Musik", icon: "M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3", desc: "Lagu favoritmu akan otomatis berputar mengiringi undangan saat dibuka oleh tamu." },
            { id: 'gallery', title: "Galeri Foto/Video", icon: "M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z", desc: "Bagikan momen bahagiamu dengan menampilkan galeri foto prewedding dan video cinematic." },
            { id: 'animasi', title: "Animasi Gratis", icon: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z", desc: "Kami sediakan ratusan karakter animasi lucu dan menarik yang bisa kamu pakai gratis." },
            { id: 'rsvp', title: "Fitur RSVP", icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4", desc: "Dapatkan kepastian jumlah tamu dengan fitur konfirmasi kehadiran (Hadir/Tidak/Ragu)." },
            { id: 'wishes', title: "Ucapan & Doa", icon: "M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z", desc: "Tamu undangan bisa memberikan ucapan selamat dan doa restu langsung di dalam undangan." },
            { id: 'gift', title: "Wedding Gift", icon: "M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7", desc: "Memudahkan tamu mengirimkan hadiah atau angpao digital melalui transfer bank/e-wallet." },
            { id: 'love', title: "Love Story", icon: "M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z", desc: "Ceritakan perjalanan kisah cintamu dengan pasangan dari awal bertemu hingga pelaminan." },
            { id: 'countdown', title: "Countdown", icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z", desc: "Hitung mundur waktu menuju momen bahagiamu agar tamu selalu ingat tanggalnya." },
            { id: 'gcal', title: "Google Calendar", icon: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z", desc: "Tamu bisa menyimpan jadwal acaramu ke Google Calendar mereka dengan satu klik." },
            { id: 'quotes', title: "Ayat & Quotes", icon: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253", desc: "Tampilkan ayat suci atau kata-kata mutiara favoritmu sebagai pemanis undangan." },
            { id: 'maps', title: "Peta Navigasi", icon: "M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0zM15 11a3 3 0 11-6 0 3 3 0 016 0z", desc: "Panduan lokasi acara akurat dengan Google Maps agar tamu mudah menemukan tempatnya." },
            { id: 'tools', title: "Sender Tools", icon: "M12 19l9 2-9-18-9 18 9-2zm0 0v-8", desc: "Fitur eksklusif untuk mengirim undangan ke banyak kontak WhatsApp secara otomatis & personal." },
            { id: 'qrcode', title: "QR Code Check In", icon: "M12 4v1m6 11h2m-6 0h-2v4h2v-4zm-6 12v-2m0 0v-2m0 2H4m8-10V4m6 11v-4m-6 4H4m8 0h2m-6 0h2v4H6v-4zm2-6h2v4h-2V9zm-2 0h-2v4h2V9zm-6 0H4v4h2V9zm6-6h2v4h-2V3zm-2 0h-2v4h2V3zm-6 0H4v4h2V3z", desc: "Dapatkan Buku Tamu digital sekaligus QR Code otomatis yang akan membantumu mengetahui apakah tamu yang kamu undang hadir ke acaramu beserta waktu check in-nya" },
            { id: 'screen', title: "Layar Sapa", icon: "M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z", desc: "Layar Sapa Real Time. Saat tamu berhasil check in ke acaramu, maka nama tamu akan ditampilkan di layar sapa yang telah disediakan, sehingga tamu merasa lebih dihormati dan dihargai." }
        ];

        const EXTRA_SERVICES_DB = [
            { id: 'revisi', title: "Free Revisi", icon: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15", desc: "Kami memastikan undangan yang kamu pesan tanpa ada kendala, untuk itu kami beri jaminan Revisi Gratis hingga hari H." },
            { id: 'fee', title: "Fixed Fee", icon: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z", desc: "Kami memastikan harga yang tertera di katalog adalah harga final yang perlu kamu bayar. Tanpa biaya ini itu!" },
            { id: 'response', title: "Fast Response", icon: "M13 10V3L4 14h7v7l9-11h-7z", desc: "Kami akan selalu berupaya untuk membalas pesanmu secepat yang kami bisa. Dan juga seramah yang kami bisa tentunya ^^" },
            { id: 'pro', title: "Profesional", icon: "M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138z", desc: "Kami memastikan bahwa undangan yang kamu pesan dikerjakan dengan hati, profesional, baik, dan sungguh-sungguh." },
            { id: 'privacy', title: "Privasi Data", icon: "M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z", desc: "Kami memastikan semua data yang kamu kirim, termasuk nama, foto, alamat, nomor WA, aman dan tidak disalahgunakan." },
            { id: 'pay', title: "Bayar Setelah Jadi", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z", desc: "Yup! Ini adalah bukti keseriusan kami dalam menjalankan usaha. Kami percaya orang baik pasti bertemu dengan orang baik." }
        ];

        // --- 2. CONFIGURATION & STATE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDq6LjlUFRDm5CqGSqVLiJ9gItIyw71bAU",
            authDomain: "db-katalog.firebaseapp.com",
            projectId: "db-katalog",
            storageBucket: "db-katalog.firebasestorage.app",
            messagingSenderId: "597535674259",
            appId: "1:597535674259:web:0577885c617f623bb82266"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let allProducts = [];
        let groupedProducts = {};
        let currentCategoryFilter = 'tema-wedding'; 
        let TIER_CONFIG = {};
        
        // REVISI: Variabel untuk melacak navigasi internal
        let hasInternalNavigation = false;

        // Variabel Status Galeri Slider
        let currentGalleryIndex = 0;
        let galleryImagesArray = [];

        const IMAGEKIT_BASE = "https://ik.imagekit.io/undangandigital";
        
        const TIER_ORDER = [
            "Starter", "Bronze", "Silver", "Gold", "Platinum", "Diamond", 
            "Birthday", "Khitan", "Aqiqah",
            "Tema Adat Jawa", "Tema Adat Bugis", "Tema Adat Batak", "Tema Adat Karo", "Tema Adat Nias"
        ];

        const CATEGORY_DATA = {
            'Wedding': { id: 'tema-wedding', label: 'Wedding Collections', icon: 'üíç', desc: 'Temukan desain undangan pernikahan impian Anda.' },
            'Kids': { id: 'acara-anak', label: 'Kids Collections', icon: 'üéà', desc: 'Tema ceria untuk Aqiqah, Ulang Tahun, dan Khitan.' },
            'Formal': { id: 'acara-formal', label: 'Formal Events', icon: 'üè¢', desc: 'Undangan resmi untuk Seminar, Rapat, dan Gathering.' },
            'Teen': { id: 'teen-and-card', label: 'Teen & Cards', icon: 'üé∏', desc: 'Desain kekinian untuk Sweet 17 dan Ucapan Digital.' },
            'School': { id: 'school-and-graduation', label: 'School & Grad', icon: 'üéì', desc: 'Rayakan kelulusan dan perpisahan sekolah.' },
            'Lainnya': { id: 'acara-lainnya', label: 'Other Events', icon: 'üìÇ', desc: 'Berbagai tema unik untuk kebutuhan acaramu.' }
        };

        // --- 3. UI LOGIC ---
        
        let lastScrollTop = 0;
        const smartHeader = document.getElementById('smart-header');
        
        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > 300) {
                smartHeader.classList.remove('header-hidden');
                smartHeader.classList.add('header-visible');
            } else {
                smartHeader.classList.remove('header-visible');
                smartHeader.classList.add('header-hidden');
            }
            lastScrollTop = scrollTop;
        });

        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function selectCategory(uiKey) {
            const catData = CATEGORY_DATA[uiKey];
            if (!catData) return;

            currentCategoryFilter = catData.id;

            document.getElementById('header-cat-text').innerText = uiKey; 
            document.getElementById('header-cat-icon').innerText = catData.icon;
            
            document.getElementById('collection-title').innerText = catData.label;
            document.getElementById('collection-desc').innerText = catData.desc;

            renderHome();

            const target = document.getElementById('tier-list-container');
            if (target) {
                const headerOffset = 85; 
                const elementPosition = target.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
            }
        }

        function openSheet(id) {
            const sheet = document.getElementById(id);
            const backdrop = document.getElementById('backdrop-' + id);
            
            if(backdrop) {
                backdrop.classList.remove('hidden');
                setTimeout(() => {
                    backdrop.classList.remove('backdrop-closed');
                    backdrop.classList.add('backdrop-open');
                }, 10);
            }
            if(sheet) {
                sheet.classList.remove('sheet-closed');
                sheet.classList.add('sheet-open');
            }
        }

        function closeSheet(id) {
            const sheet = document.getElementById(id);
            const backdrop = document.getElementById('backdrop-' + id);
            
            if(sheet) {
                sheet.classList.remove('sheet-open');
                sheet.classList.add('sheet-closed');
            }
            if(backdrop) {
                backdrop.classList.remove('backdrop-open');
                backdrop.classList.add('backdrop-closed');
                setTimeout(() => {
                    backdrop.classList.add('hidden');
                }, 300);
            }
        }

        function kirimPesanUmum() {
            const text = `Halo Admin üëã\nSaya ingin konsultasi mengenai pemesanan undangan digital.`;
            const url = `https://wa.me/6285117173637?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function kirimPesanCustom() {
            const text = `Halo Admin üëã\nSaya tertarik untuk order Undangan Custom Design yang exclusive. Bisa info detailnya?`;
            const url = `https://wa.me/6285117173637?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        window.addEventListener('hashchange', router);

        function router() {
            const hash = window.location.hash;
            closeGallery(); 
            closeFeatureSheet(); 
            closeSheet('order-sheet');
            closeSheet('animasi-sheet');

            if (!hash || hash === '#/') {
                switchView('view-home');
                return;
            }
            if (hash.startsWith('#/category/')) {
                const tier = decodeURIComponent(hash.split('/')[2]);
                renderCategoryView(tier);
                switchView('view-category');
                return;
            }
            if (hash.startsWith('#/detail/')) {
                const id = hash.split('/')[2];
                if (allProducts.length > 0) {
                    const item = allProducts.find(p => p.id === id);
                    if (item) {
                        try {
                            renderDetailView(item);
                            switchView('view-detail');
                        } catch (e) {
                            console.error("Critical Error Render Detail:", e);
                            alert("Maaf, terjadi kesalahan saat memuat detail tema ini.");
                            window.location.hash = '#/';
                        }
                    } else {
                        window.location.hash = '#/';
                    }
                }
                return;
            }
        }

        function switchView(viewId) {
            const targetElement = document.getElementById(viewId);
            if(!targetElement) {
                console.error(`[Navigation Error] View dengan ID '${viewId}' tidak ditemukan.`);
                return;
            }
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('view-active'));
            targetElement.classList.add('view-active');
            window.scrollTo(0,0);
        }

        function navigateTo(path) {
            // REVISI: Tandai bahwa ini adalah navigasi internal
            hasInternalNavigation = true;
            window.location.hash = path;
        }

        function goBack() {
            // REVISI: Logika Back Button Cerdas
            // Jika user menavigasi dari dalam aplikasi, gunakan history browser
            if (hasInternalNavigation && window.history.length > 1) {
                window.history.back();
            } else {
                // Jika user membuka link langsung (Direct Link via WA), paksa kembali ke Home
                window.location.hash = '#/';
            }
        }

        async function loadData() {
            try {
                // 1. Load Config
                try {
                    const configSnap = await db.collection('config').doc('tiers').get();
                    if (configSnap.exists) {
                        TIER_CONFIG = configSnap.data();
                    }
                } catch (errConfig) {
                    console.error("Config Error:", errConfig);
                }

                // 2. Load Products
                const snapshot = await db.collection('themes').get();
                const loadingEl = document.getElementById('home-loading');
                if (loadingEl) loadingEl.style.display = 'none';

                if (snapshot.empty) { 
                    alert("Data kosong!"); 
                    return; 
                }

                allProducts = snapshot.docs.map(doc => {
                    let d = doc.data();
                    let variants = d.variants || [];
                    if (Array.isArray(variants)) {
                        variants = variants.map(v => v.trim()); 
                    }
                    
                    let desc = d.description || '';
                    desc = desc.replace(/\n\uFFFD/g, '\n‚Ä¢').replace(/^\uFFFD/, '‚Ä¢');
                    desc = desc.replace(/\uFFFD/g, '-');
                    desc = desc.replace(/Cek preview link dibawah ini:\s*\?+/gi, 'Cek preview link dibawah ini: üëá‚§µÔ∏è');

                    return {
                        id: doc.id,
                        title: d.title || d['title '] || 'Tanpa Judul',
                        category: d.category ? d.category.toLowerCase().trim() : 'umum',
                        price_real: d.price_real || d['price-real'] || 0,
                        price_fake: d.price_fake || d['price-fake'] || 0,
                        description: desc,
                        folder_id: d.folder_id || doc.id,
                        tier: (d.tier || 'Starter').trim(),
                        variants: variants,
                        link: d.link || '#',
                        photoRequired: d['photo-required'] || d.photo_required || 'no',
                        label: d.label || '' // Logic Label Baru
                    };
                });

                renderHome();
                router();

            } catch (error) {
                console.error("Error:", error);
                const loadingEl = document.getElementById('home-loading');
                if (loadingEl) loadingEl.style.display = 'none';
                const errorEl = document.getElementById('error-message');
                if (errorEl) {
                    errorEl.classList.remove('hidden');
                    document.getElementById('error-text').innerText = error.message;
                }
            }
        }

        function renderHome() {
            const container = document.getElementById('tier-list-container');
            if (!container) return;
            container.innerHTML = '';

            const filteredProducts = allProducts.filter(p => p.category === currentCategoryFilter);

            if (filteredProducts.length === 0) {
                container.innerHTML = `<div class="text-center py-10 opacity-60"><p class="text-sm text-wa-gray">Belum ada tema di kategori ini</p></div>`;
                return;
            }

            const grouped = {};
            filteredProducts.forEach(p => {
                if(!grouped[p.tier]) grouped[p.tier] = [];
                grouped[p.tier].push(p);
            });

            const availableTiers = Object.keys(grouped);
            availableTiers.sort((a, b) => {
                const idxA = TIER_ORDER.indexOf(a);
                const idxB = TIER_ORDER.indexOf(b);
                if (idxA !== -1 && idxB !== -1) return idxA - idxB;
                if (idxA !== -1) return -1;
                if (idxB !== -1) return 1;
                return a.localeCompare(b);
            });

            availableTiers.forEach(tier => {
                const products = grouped[tier];
                const prices = products.map(p => p.price_real);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const priceRange = minPrice === maxPrice ? `All price at Rp${Math.floor(minPrice/1000)}k` : `Rp${Math.floor(minPrice/1000)}k - Rp${Math.floor(maxPrice/1000)}k`;
                const emoji = TIER_CONFIG[tier] || "üîñ"; 
                const previewProducts = products.slice(0, 3);
                
                let cardsHtml = '';
                previewProducts.forEach(item => {
                    const imgPng = `${IMAGEKIT_BASE}/${item.folder_id}/01.png?tr=w-400`;
                    const imgWebp = `${IMAGEKIT_BASE}/${item.folder_id}/01.webp?tr=w-400`;
                    const imgJpg = `${IMAGEKIT_BASE}/${item.folder_id}/01.jpg?tr=w-400`;
                    const price = 'Rp' + Math.floor(item.price_real / 1000) + 'k';
                    const fakePrice = 'Rp' + Math.floor(item.price_fake / 1000) + 'k';
                    
                    let discountHtml = '';
                    let priceHtml = '';
                    
                    // Logic Tampilan Harga (Toggle via SHOW_PRICE)
                    if (SHOW_PRICE) {
                        if (item.price_fake > item.price_real) {
                            const discount = Math.round(((item.price_fake - item.price_real) / item.price_fake) * 100);
                            discountHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10 border border-white/10">-${discount}%</div>`;
                        }
                        priceHtml = `<div class="flex items-center gap-1.5 mt-1.5">
                                        <span class="text-sm text-wa-teal font-bold">${price}</span>
                                        ${item.price_fake > item.price_real ? `<span class="text-[10px] text-wa-gray line-through decoration-red-500/50">${fakePrice}</span>` : ''}
                                     </div>`;
                    } else {
                        // LOGIC BARU: TAMPILKAN TIER BADGE + BUTTON JIKA NO PRICE
                        // Clean "Tema " from tier name to save space
                        let shortTier = item.tier.replace(/Tema /gi, '').trim();
                        // Truncate logic handled by CSS 'truncate'
                        
                        priceHtml = `
                        <div class="mt-2 flex items-center justify-between gap-2">
                            <!-- Tier Capsule -->
                            <div class="flex-1 min-w-0">
                                <div class="inline-flex items-center gap-1.5 px-2 py-1 rounded-lg bg-[#2a373f] border border-white/5 w-full max-w-full">
                                    <span class="text-[10px] shrink-0 filter drop-shadow-sm">${emoji}</span>
                                    <span class="text-[10px] text-wa-light/80 font-medium truncate tracking-wide">${shortTier}</span>
                                </div>
                            </div>
                            <!-- Action Button -->
                            <div class="shrink-0">
                                <div class="w-7 h-7 flex items-center justify-center rounded-full bg-wa-teal/10 text-wa-teal border border-wa-teal/20 group-hover:bg-wa-teal group-hover:text-white transition-all duration-300">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                </div>
                            </div>
                        </div>`;
                    }

                    // Logic Tampilan Badge Label (Best Seller dll)
                    let badgeHtml = '';
                    if (item.label) {
                        let badgeColor = 'bg-gray-600';
                        let badgeText = item.label;
                        if(item.label === 'Best Seller') badgeColor = 'bg-gradient-to-r from-yellow-600 to-yellow-400';
                        else if(item.label === 'New Arrival') badgeColor = 'bg-gradient-to-r from-teal-500 to-emerald-400';
                        else if(item.label === 'Premium') badgeColor = 'bg-gradient-to-r from-purple-600 to-purple-400';
                        else if(item.label === 'Recommended') badgeColor = 'bg-gradient-to-r from-blue-600 to-blue-400';
                        
                        badgeHtml = `<div class="absolute top-0 right-0 z-20">
                                        <div class="${badgeColor} text-white text-[9px] font-bold px-3 py-1 rounded-bl-xl shadow-lg badge-shine tracking-wide uppercase">
                                            ${badgeText}
                                        </div>
                                     </div>`;
                    }

                    cardsHtml += `
                        <div onclick="navigateTo('#/detail/${item.id}')" class="grid-3d group relative bg-[#202c33] rounded-xl overflow-hidden cursor-pointer animate-fade-up" style="animation-delay: 0.1s">
                            <div class="aspect-square overflow-hidden relative">
                                ${discountHtml}
                                ${badgeHtml}
                                <img src="${imgPng}" onerror="if(this.src.includes('.png')){this.src='${imgWebp}'}else if(this.src.includes('.webp')){this.src='${imgJpg}'}else{this.parentElement.remove()}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60"></div>
                            </div>
                            <div class="p-3">
                                <h4 class="text-xs text-wa-light font-bold truncate group-hover:text-wa-teal transition-colors tracking-wide">${item.title}</h4>
                                ${priceHtml}
                            </div>
                        </div>
                    `;
                });

                const encodedTier = encodeURIComponent(tier).replace(/'/g, '%27');
                const section = document.createElement('div');
                section.className = "mb-4"; 
                // Hide price range in header if SHOW_PRICE is false
                const headerPrice = SHOW_PRICE ? priceRange : "Lihat Koleksi Lengkap";

                section.innerHTML = `
                    <div class="px-4 flex justify-between items-center mb-3">
                        <div class="border-l-4 border-wa-teal pl-3">
                            <div class="flex items-center gap-2"><span class="text-lg filter drop-shadow-sm">${emoji}</span><h2 class="text-wa-light font-bold text-base tracking-wide">${tier}</h2></div>
                            <p class="text-[11px] text-wa-gray mt-0.5 font-medium tracking-wide uppercase">${headerPrice}</p>
                        </div>
                        <button onclick="navigateTo('#/category/${encodedTier}')" class="bg-[#2a373f] border border-wa-divider text-wa-teal text-[11px] font-bold px-3.5 py-1.5 rounded-full hover:bg-wa-teal hover:text-white hover:border-transparent transition active:scale-95 shadow-sm uppercase tracking-wider">Lihat Semua</button>
                    </div>
                    <div class="px-4 grid grid-cols-3 gap-3">${cardsHtml}</div>
                `;
                container.appendChild(section);
            });
            groupedProducts = grouped;
        }

        function renderCategoryView(tierName) {
            const products = groupedProducts[tierName];
            if(!products) return;
            
            const emoji = TIER_CONFIG[tierName] || "üîñ";
            const titleEl = document.getElementById('cat-header-title');
            if(titleEl) titleEl.innerText = `${emoji} ${tierName}`;
            const countEl = document.getElementById('cat-header-count');
            if(countEl) countEl.innerText = `${products.length} Tema Tersedia`;

            const container = document.getElementById('cat-grid-container');
            if(!container) return; 
            container.innerHTML = '';

            products.forEach((item, index) => {
                const imgPng = `${IMAGEKIT_BASE}/${item.folder_id}/01.png?tr=w-400`;
                const imgWebp = `${IMAGEKIT_BASE}/${item.folder_id}/01.webp?tr=w-400`;
                const imgJpg = `${IMAGEKIT_BASE}/${item.folder_id}/01.jpg?tr=w-400`;
                const price = 'Rp' + Math.floor(item.price_real / 1000) + 'k';
                const fakePrice = 'Rp' + Math.floor(item.price_fake / 1000) + 'k';
                
                let discountHtml = '';
                let priceHtml = '';

                // Logic Tampilan Harga (Toggle via SHOW_PRICE)
                if (SHOW_PRICE) {
                    if (item.price_fake > item.price_real) {
                        const discount = Math.round(((item.price_fake - item.price_real) / item.price_fake) * 100);
                        discountHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm z-10 border border-white/10">-${discount}%</div>`;
                    }
                    priceHtml = `<div class="flex items-center gap-1.5 mt-1.5"><span class="text-sm text-wa-teal font-bold">${price}</span>${item.price_fake > item.price_real ? `<span class="text-[10px] text-wa-gray line-through decoration-red-500/50">${fakePrice}</span>` : ''}</div>`;
                } else {
                    // LOGIC BARU: TAMPILKAN TIER BADGE + BUTTON JIKA NO PRICE
                    let shortTier = item.tier.replace(/Tema /gi, '').trim();
                    
                    priceHtml = `
                    <div class="mt-2 flex items-center justify-between gap-2">
                        <!-- Tier Capsule -->
                        <div class="flex-1 min-w-0">
                            <div class="inline-flex items-center gap-1.5 px-2 py-1 rounded-lg bg-[#2a373f] border border-white/5 w-full max-w-full">
                                <span class="text-[10px] shrink-0 filter drop-shadow-sm">${emoji}</span>
                                <span class="text-[10px] text-wa-light/80 font-medium truncate tracking-wide">${shortTier}</span>
                            </div>
                        </div>
                        <!-- Action Button -->
                        <div class="shrink-0">
                            <div class="w-7 h-7 flex items-center justify-center rounded-full bg-wa-teal/10 text-wa-teal border border-wa-teal/20 group-hover:bg-wa-teal group-hover:text-white transition-all duration-300">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>
                    </div>`;
                }

                // Logic Badge di Kategori View
                let badgeHtml = '';
                if (item.label) {
                    let badgeColor = 'bg-gray-600';
                    if(item.label === 'Best Seller') badgeColor = 'bg-gradient-to-r from-yellow-600 to-yellow-400';
                    else if(item.label === 'New Arrival') badgeColor = 'bg-gradient-to-r from-teal-500 to-emerald-400';
                    else if(item.label === 'Premium') badgeColor = 'bg-gradient-to-r from-purple-600 to-purple-400';
                    else if(item.label === 'Recommended') badgeColor = 'bg-gradient-to-r from-blue-600 to-blue-400';
                    
                    badgeHtml = `<div class="absolute top-0 right-0 z-20">
                                    <div class="${badgeColor} text-white text-[9px] font-bold px-3 py-1 rounded-bl-xl shadow-lg badge-shine tracking-wide uppercase">
                                        ${item.label}
                                    </div>
                                 </div>`;
                }

                const card = document.createElement('div');
                card.className = "grid-3d group relative bg-[#202c33] rounded-xl overflow-hidden cursor-pointer animate-fade-up";
                card.style.animationDelay = `${index * 0.05}s`;
                card.onclick = () => navigateTo(`#/detail/${item.id}`);
                card.innerHTML = `
                    <div class="aspect-square overflow-hidden relative">
                        ${discountHtml}
                        ${badgeHtml}
                        <img src="${imgPng}" onerror="if(this.src.includes('.png')){this.src='${imgWebp}'}else if(this.src.includes('.webp')){this.src='${imgJpg}'}else{this.parentElement.remove()}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60"></div>
                    </div>
                    <div class="p-3">
                        <h4 class="text-xs text-wa-light font-bold truncate group-hover:text-wa-teal transition-colors tracking-wide">${item.title}</h4>
                        ${priceHtml}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderDetailView(item) {
            window.currentItem = item;
            window.currentGalleryItem = item; 

            // --- REVISI: Cek kategori ---
            const isWedding = item.category === 'tema-wedding';
            const isSchoolEvent = item.category === 'school-and-graduation';
            const isKidsEvent = item.category === 'acara-anak';
            const isTeenEvent = item.category === 'teen-and-card';
            const isOtherEvent = item.category === 'acara-lainnya';
            const isFormalEvent = item.category === 'acara-formal';

            const titleEl = document.getElementById('detail-title');
            if(titleEl) titleEl.innerText = item.title;
            
            // Logic Tampilan Harga Detail (Toggle via SHOW_PRICE)
            const priceContainer = document.getElementById('detail-price-container');
            if(priceContainer) {
                if(SHOW_PRICE) {
                    priceContainer.style.display = 'flex'; // Tampilkan
                    const priceRealEl = document.getElementById('detail-price-real');
                    if(priceRealEl) priceRealEl.innerText = 'Rp ' + item.price_real.toLocaleString('id-ID');
                    const priceFakeEl = document.getElementById('detail-price-fake');
                    if(priceFakeEl) priceFakeEl.innerText = 'Rp ' + item.price_fake.toLocaleString('id-ID');
                } else {
                    priceContainer.style.display = 'none'; // Sembunyikan
                }
            }

            const descEl = document.getElementById('detail-desc');
            if(descEl) descEl.innerText = item.description;

            let categoryLabel = "Event";
            if(isWedding) categoryLabel = "Wedding";
            else if(isKidsEvent) categoryLabel = "Kids";
            else if(isFormalEvent) categoryLabel = "Formal";
            else if(isTeenEvent) categoryLabel = "Teen";
            else if(isSchoolEvent) categoryLabel = "School";
            else categoryLabel = "General";

            let cleanTier = (item.tier || "").replace(/Tema|Wedding|Kids|Acara/gi, '').trim();
            let detailEmoji = TIER_CONFIG[item.tier] || TIER_CONFIG[cleanTier] || "‚ú®"; 
            const catEl = document.getElementById('detail-category');
            if(catEl) catEl.innerText = `${detailEmoji} ${categoryLabel} ${cleanTier}`;

            const alertContainer = document.getElementById('detail-photo-alert');
            if(alertContainer) {
                if (item.photoRequired === 'yes') {
                    alertContainer.innerHTML = `<div class="bg-yellow-900/20 border border-yellow-600/30 rounded-xl p-4 flex items-start gap-3"><svg class="w-5 h-5 text-yellow-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div><h4 class="text-sm font-bold text-yellow-500 mb-1">Penting!</h4><p class="text-xs text-wa-light/80 leading-relaxed">Tema ini memerlukan banyak foto prewedding (minimal 5 foto) untuk hasil maksimal.</p></div></div>`;
                    alertContainer.classList.remove('hidden');
                } else {
                    alertContainer.classList.add('hidden');
                    alertContainer.innerHTML = '';
                }
            }

            const previewContainer = document.getElementById('detail-preview-buttons');
            if(previewContainer) {
                previewContainer.innerHTML = '';
                const titleLabel = document.createElement('h3');
                titleLabel.className = "text-xs font-bold text-wa-gray uppercase tracking-wider mb-3 col-span-full flex items-center gap-2";
                titleLabel.innerHTML = "<span class='w-1 h-3 bg-wa-teal rounded-full'></span> Lihat <span class='text-wa-teal'>Live Pre</span>view";
                previewContainer.appendChild(titleLabel);

                const buttonsWrapper = document.createElement('div');
                buttonsWrapper.className = "flex flex-col gap-2";
                previewContainer.appendChild(buttonsWrapper);
                
                // --- REVISI: LOGIC TOMBOL PREVIEW ---
                if (!isWedding) {
                    // JIKA BUKAN WEDDING, LANGSUNG TAMPILKAN TOMBOL DEFAULT
                    createPreviewButton(buttonsWrapper, item.link, "LIHAT PREVIEW UNDANGAN", "default", true);
                } else {
                    // JIKA WEDDING, GUNAKAN LOGIC VARIAN
                    const baseUrl = item.link.replace(/\/$/, ""); 
                    const sortOrder = ['foto', 'animasi', 'no-foto'];
                    const sortedVariants = (item.variants || [])
                        .filter(v => ['foto', 'animasi', 'no-foto'].includes(v))
                        .sort((a,b) => sortOrder.indexOf(a) - sortOrder.indexOf(b));

                    if (sortedVariants.length === 0) {
                        createPreviewButton(buttonsWrapper, item.link, "Preview Undangan", "default", true);
                    } else if (sortedVariants.length === 1) {
                        const variant = sortedVariants[0];
                        const d = getVariantDetails(variant, item, sortedVariants);
                        createPreviewButton(buttonsWrapper, d.url, "Preview " + d.label, d.icon, true);
                    } else {
                        const v1 = sortedVariants[0];
                        const d1 = getVariantDetails(v1, item, sortedVariants);
                        createPreviewButton(buttonsWrapper, d1.url, "Preview " + d1.label, d1.icon, true);
                        const grid = document.createElement('div');
                        grid.className = "grid grid-cols-2 gap-2";
                        buttonsWrapper.appendChild(grid);
                        for(let i=1; i<sortedVariants.length; i++) {
                            const v = sortedVariants[i];
                            const d = getVariantDetails(v, item, sortedVariants);
                            createPreviewButton(grid, d.url, d.label, d.icon, false);
                        }
                    }
                }
            }

            // --- REVISI: SEMBUNYIKAN SECTION VARIAN JIKA BUKAN WEDDING ---
            const sectionVariantsWrapper = document.getElementById('section-variants-wrapper');
            if (sectionVariantsWrapper) {
                if (isWedding) {
                    sectionVariantsWrapper.classList.remove('hidden'); // Tampilkan jika wedding
                    
                    const variantContainer = document.getElementById('detail-variants');
                    if(variantContainer) {
                        variantContainer.innerHTML = '';
                        if(item.variants && item.variants.length > 0) {
                            item.variants.forEach(v => {
                                variantContainer.innerHTML += `<a href="${getVariantDetails(v, item, item.variants).url}" target="_blank" class="text-[11px] bg-wa-header border border-wa-divider text-wa-teal hover:text-white hover:bg-wa-teal hover:border-wa-teal px-3 py-1.5 rounded-lg capitalize tracking-wide shadow-sm transition-all duration-200 flex items-center gap-1">${v.replace('-', ' ')} <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a>`;
                            });
                        } else {
                            variantContainer.innerHTML = '<span class="text-xs text-wa-gray italic">Tidak ada info fitur khusus</span>';
                        }
                    }
                } else {
                    sectionVariantsWrapper.classList.add('hidden'); // Sembunyikan jika bukan wedding
                }
            }

            const featuresContainer = document.getElementById('detail-features');
            if(featuresContainer) {
                featuresContainer.innerHTML = '';
                const isDwigital = item.link && item.link.includes('dwigital.com');
                
                let featuresToShow = FEATURES_DB.filter(f => {
                    if (item.tier === 'Starter' && (f.id === 'gallery' || f.id === 'animasi')) return false;
                    
                    // Logic Filter Per Kategori
                    if (isSchoolEvent) {
                        if (['love', 'gift'].includes(f.id)) return false; 
                        if (['qrcode', 'screen'].includes(f.id)) return true;
                    } 
                    else if (isKidsEvent) {
                        if (['love'].includes(f.id)) return false;
                        if (['rsvp', 'qrcode', 'screen'].includes(f.id)) return true; // RSVP useful for kids party
                    }
                    else if (isTeenEvent) {
                        if (['love'].includes(f.id)) return false;
                    }
                    else if (isOtherEvent) {
                        if (['love'].includes(f.id)) return false;
                    }
                    else if (isFormalEvent) {
                        if (['love', 'gift', 'quotes'].includes(f.id)) return false;
                        if (['qrcode', 'screen'].includes(f.id)) return true;
                    }
                    else {
                         // Default / Wedding
                        if ((f.id === 'qrcode' || f.id === 'screen') && !isDwigital) return false;
                    }
                    return true;
                });

                if (isFormalEvent) featuresToShow = [...featuresToShow, ...FORMAL_FEATURES_ADDONS];
                if (isSchoolEvent) featuresToShow = [...featuresToShow, ...SCHOOL_FEATURES_ADDONS];
                if (isKidsEvent) featuresToShow = [...featuresToShow, ...KIDS_FEATURES_ADDONS];
                if (isTeenEvent) featuresToShow = [...featuresToShow, ...TEEN_FEATURES_ADDONS];
                if (isOtherEvent) featuresToShow = [...featuresToShow, ...OTHER_FEATURES_ADDONS];

                featuresToShow.forEach(f => {
                    let displayTitle = f.title;
                    let displayDesc = f.desc;
                    
                    // REVISI: Custom wording per kategori
                    if (isKidsEvent) {
                        if (f.id === 'music') { displayTitle = "Lagu Ceria"; displayDesc = "Musik latar ceria yang disukai anak-anak."; }
                        if (f.id === 'gallery') { displayTitle = "Foto Si Kecil"; displayDesc = "Kumpulan foto kelucuan dan tumbuh kembang si kecil."; }
                        if (f.id === 'gift') { displayTitle = "Kado Ulang Tahun"; displayDesc = "Kirim hadiah atau angpao digital untuk si kecil."; }
                        if (f.id === 'quotes') { displayTitle = "Doa Orang Tua"; displayDesc = "Harapan dan doa terbaik ayah bunda untuk masa depan anak."; }
                    }

                    if (isTeenEvent) {
                        if (f.id === 'music') { displayTitle = "Trending Music"; displayDesc = "Musik hits pilihanmu yang bikin suasana makin asik."; }
                        if (f.id === 'gallery') { displayTitle = "Portrait Gallery"; displayDesc = "Deretan foto aesthetic dan momen seru kamu."; }
                        if (f.id === 'wishes') { displayTitle = "Best Wishes"; displayDesc = "Kolom ucapan dan harapan dari bestie-bestie kamu."; }
                        if (f.id === 'gift') { displayTitle = "Birthday Gift"; displayDesc = "Tanda sayang dan kado dari teman-teman."; }
                    }

                    if (isOtherEvent) {
                        if (f.id === 'music') { displayTitle = "Backsound Acara"; displayDesc = "Musik pengiring yang sesuai dengan tema acara."; }
                        if (f.id === 'gallery') { displayTitle = "Galeri"; displayDesc = "Dokumentasi foto terkait kegiatan acara."; }
                        if (f.id === 'gift') { displayTitle = "Tanda Kasih"; displayDesc = "Fitur kirim hadiah digital (opsional)."; }
                    }
                    
                    if (isFormalEvent) {
                        if (f.id === 'wishes') displayTitle = "Message Wall";
                        if (f.id === 'gallery') displayTitle = "Dokumentasi";
                        if (f.id === 'music') displayDesc = "Lagu instrumen corporate atau grand yang elegan.";
                        if (f.id === 'animasi') displayDesc = "Animasi transisi yang formal dan profesional.";
                    }

                    if (isSchoolEvent) {
                        if (f.id === 'music') { displayTitle = "Mars & Hymne"; displayDesc = "Otomatis memutar lagu Mars Universitas atau Hymne Sekolah."; }
                        if (f.id === 'gallery') { displayTitle = "Galeri Kenangan"; displayDesc = "Tampilkan foto-foto nostalgia masa sekolah/kuliah."; }
                        if (f.id === 'wishes') { displayTitle = "Ucapan Selamat"; displayDesc = "Fitur bagi teman/keluarga memberikan ucapan selamat wisuda."; }
                        if (f.id === 'quotes') { displayTitle = "Quotes Motivasi"; displayDesc = "Kata-kata mutiara tentang pendidikan dan masa depan."; }
                        if (f.id === 'animasi') { displayTitle = "Animasi Opening"; displayDesc = "Animasi pembuka yang elegan sesuai tema institusi."; }
                    }

                    const featureObj = { ...f, title: displayTitle, desc: displayDesc };
                    const chip = document.createElement('button');
                    chip.className = "border border-wa-divider bg-wa-header px-3 py-1.5 rounded-full text-[11px] text-wa-light flex items-center gap-2 hover:border-wa-teal/50 hover:bg-[#2a373f] transition active:scale-95";
                    chip.onclick = () => openFeatureSheet(featureObj);
                    chip.innerHTML = `<svg class="w-3.5 h-3.5 text-wa-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${f.icon}"></path></svg>${displayTitle}`;
                    featuresContainer.appendChild(chip);
                });
            }

            const extraContainer = document.getElementById('detail-extra-services');
            if(extraContainer) {
                extraContainer.innerHTML = '';
                EXTRA_SERVICES_DB.forEach(s => {
                    const chip = document.createElement('button');
                    chip.className = "border border-wa-divider bg-wa-header px-3 py-1.5 rounded-full text-[11px] text-wa-light flex items-center gap-2 hover:border-wa-teal/50 hover:bg-[#2a373f] transition active:scale-95";
                    chip.onclick = () => openFeatureSheet(s);
                    chip.innerHTML = `<svg class="w-3.5 h-3.5 text-wa-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${s.icon}"></path></svg>${s.title}`;
                    extraContainer.appendChild(chip);
                });
            }

            const slider = document.getElementById('detail-slider');
            if(slider) {
                slider.innerHTML = '';
                requestAnimationFrame(() => { slider.scrollLeft = 0; });
                for (let i = 1; i <= 10; i++) {
                    const num = String(i).padStart(2, '0');
                    let imgBase = (i <= 8) ? `${IMAGEKIT_BASE}/${item.folder_id}/${num}` : `${IMAGEKIT_BASE}/feature-service/${num}`;
                    let imgPng = `${imgBase}.png?tr=w-400`;
                    let imgWebp = `${imgBase}.webp?tr=w-400`;
                    let imgJpg = `${imgBase}.jpg?tr=w-400`;
                    
                    const slideItem = document.createElement('div');
                    slideItem.className = "snap-center shrink-0 w-[85%] h-full flex items-center justify-center bg-wa-header rounded-xl overflow-hidden relative border border-wa-divider cursor-pointer shadow-lg active:scale-[0.98] transition-transform";
                    
                    // REVISI: Ambil index dari elemen DOM aktif karena yang error akan otomatis terhapus
                    slideItem.onclick = function() {
                        const index = Array.prototype.indexOf.call(this.parentNode.children, this);
                        openGallery(index); 
                    };
                    
                    slideItem.innerHTML = `<img src="${imgPng}" class="w-full h-full object-cover" loading="${i===1?'eager':'lazy'}" onerror="if(this.src.includes('.png')){this.src='${imgWebp}'}else if(this.src.includes('.webp')){this.src='${imgJpg}'}else{this.parentElement.remove()}" class="w-full h-full object-cover">`;
                    slider.appendChild(slideItem);
                }
                const progressBar = document.getElementById('slider-progress');
                if(progressBar) {
                    slider.onscroll = () => {
                        const maxScroll = slider.scrollWidth - slider.clientWidth;
                        const scrollPct = (slider.scrollLeft / maxScroll) * 100;
                        progressBar.style.width = Math.max(10, scrollPct) + "%";
                    };
                    progressBar.style.width = "10%";
                }
            }
        }

        function openFeatureSheet(feature) {
            document.getElementById('sheet-title').innerText = feature.title;
            document.getElementById('sheet-desc').innerText = feature.desc;
            document.getElementById('sheet-icon').innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${feature.icon}"></path></svg>`;
            
            const sheet = document.getElementById('feature-sheet');
            const backdrop = document.getElementById('feature-backdrop');
            
            backdrop.classList.remove('backdrop-closed');
            backdrop.classList.add('backdrop-open');
            sheet.classList.remove('sheet-closed');
            sheet.classList.add('sheet-open');
        }

        function closeFeatureSheet() {
            const sheet = document.getElementById('feature-sheet');
            const backdrop = document.getElementById('feature-backdrop');
            
            sheet.classList.remove('sheet-open');
            sheet.classList.add('sheet-closed');
            backdrop.classList.remove('backdrop-open');
            backdrop.classList.add('backdrop-closed');
        }

        function getVariantDetails(variant, item, allVariants) {
            const baseUrl = item.link.replace(/\/$/, ""); 
            let url = item.link;
            let label = "Preview";
            let icon = "default";

            if (variant === 'foto') {
                url = item.link;
                label = "Versi Foto";
                icon = "camera";
            } else if (variant === 'animasi') {
                url = allVariants.length > 1 ? baseUrl + "-animasi" : item.link;
                label = "Versi Animasi";
                icon = "play";
            } else if (variant === 'no-foto') {
                url = allVariants.length > 1 ? baseUrl + "-tanpa-foto" : item.link;
                label = "Tanpa Foto";
                icon = "doc";
            }
            return { url, label, icon };
        }

        // --- REVISI 3: FUNGSI GALERI BERUBAH MENJADI SLIDER FOKUS 1 FOTO ---
        function openGallery(actualIndex = 0) {
            const item = window.currentGalleryItem;
            if(!item) return;

            // Ambil semua img yang berhasil dimuat di thumbnail (karena yang error terhapus oleh onerror)
            const validImages = Array.from(document.querySelectorAll('#detail-slider img'));
            if (validImages.length === 0) return; // safety check

            // Mengganti resolusi w-400 dari DOM menjadi w-800 untuk versi galeri fullscreen
            galleryImagesArray = validImages.map(img => img.src.replace('tr=w-400', 'tr=w-800'));

            currentGalleryIndex = actualIndex;
            // Pastikan index tidak out-of-bounds
            if (currentGalleryIndex >= galleryImagesArray.length) currentGalleryIndex = 0;

            updateGalleryDisplay();

            const galleryView = document.getElementById('view-gallery');
            galleryView.classList.remove('gallery-closed');
            galleryView.classList.add('gallery-open');
        }

        function updateGalleryDisplay() {
            if(galleryImagesArray.length === 0) return;
            
            const imgEl = document.getElementById('gallery-main-image');
            const imgSrc = galleryImagesArray[currentGalleryIndex];
            
            // Efek memudar transisi halus
            imgEl.classList.add('opacity-0');
            
            setTimeout(() => {
                imgEl.src = imgSrc; 
                imgEl.onload = () => { imgEl.classList.remove('opacity-0'); };
                // Fallback untuk antisipasi caching sehingga gambar tetap muncul
                setTimeout(() => { imgEl.classList.remove('opacity-0'); }, 100);

            }, 200);

            // Update status nomor dan progress bar menyesuaikan dengan jumlah gambar yang ada (3, 5, atau berapapun)
            const total = galleryImagesArray.length;
            const current = currentGalleryIndex + 1;
            
            document.getElementById('gallery-counter').innerText = `${current} / ${total}`;
            const progressPct = (current / total) * 100;
            document.getElementById('gallery-progress').style.width = `${progressPct}%`;
        }

        function changeGalleryImage(direction) {
            currentGalleryIndex += direction;
            
            // Loop array bila sudah di ujung (Continuous loop)
            if (currentGalleryIndex < 0) currentGalleryIndex = galleryImagesArray.length - 1;
            if (currentGalleryIndex >= galleryImagesArray.length) currentGalleryIndex = 0;
            
            updateGalleryDisplay();
        }

        function closeGallery() {
            const galleryView = document.getElementById('view-gallery');
            galleryView.classList.remove('gallery-open');
            galleryView.classList.add('gallery-closed');
        }

        function scrollSlider(direction) {
            const slider = document.getElementById('detail-slider');
            const scrollAmount = slider.offsetWidth * 0.85; 
            slider.scrollBy({
                left: direction * scrollAmount,
                behavior: 'smooth'
            });
        }

        function createPreviewButton(container, url, text, iconType, isPrimary = false) {
            let iconSvg = '';
            if (iconType === 'camera') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
            else if (iconType === 'play') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>';
            else if (iconType === 'doc') iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>';
            else iconSvg = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>';

            const btn = document.createElement('a');
            btn.href = url;
            btn.target = "_blank";
            
            let classes = "relative overflow-hidden group border border-wa-divider rounded-xl hover:border-wa-teal transition-all active:scale-[0.98] ";
            if (isPrimary) {
                classes += "bg-[#202c33] p-4 flex items-center justify-center gap-3 w-full shadow-md";
                btn.innerHTML = `<div class="text-wa-teal group-hover:text-white transition-colors">${iconSvg}</div><span class="text-sm font-bold text-wa-light tracking-wide uppercase group-hover:text-white">${text}</span><div class="absolute inset-0 bg-wa-teal/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>`;
            } else {
                classes += "bg-[#2a373f] p-4 flex flex-row items-center justify-center gap-3 w-full shadow-sm";
                btn.innerHTML = `<div class="text-wa-teal/80 group-hover:text-white transition-colors scale-90">${iconSvg}</div><span class="text-xs font-medium text-wa-gray group-hover:text-wa-light text-center leading-tight">${text}</span>`;
            }
            btn.className = classes;
            container.appendChild(btn);
        }

        function kirimPesanWA() {
            if(!window.currentItem) return;
            const item = window.currentItem;
            
            // LOGIC PESAN WA RESELLER (Tanpa Harga)
            let text = "";
            if (SHOW_PRICE) {
                const price = item.price_real.toLocaleString('id-ID');
                text = `Halo kak üëã\nSaya ingin pesan tema *${item.title}* (Paket ${item.tier}).\nApakah betul harganya Rp. ${price}?`;
            } else {
                // Pesan Reseller/Mitra (Lebih umum)
                text = `Halo kak üëã\nSaya ingin order tema *${item.title}* (Paket ${item.tier}).\nMohon info langkah selanjutnya.`;
            }

            const url = `https://wa.me/6285117173637?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // --- NEW FUNCTION: OPEN PREVIEW DARI STICKY BUTTON ---
        function openMainPreview() {
            if(!window.currentItem) return;
            const item = window.currentItem;
            
            // Logic: Selalu buka item.link (ini adalah link utama/versi foto)
            // Sesuai request: "Jika ada tema yang terdapat 3 varian, pakai link tema versi foto"
            // Di data, item.link selalu merujuk ke versi foto/utama.
            window.open(item.link, '_blank');
        }

        window.onload = loadData;
    </script>
</body>
</html>
